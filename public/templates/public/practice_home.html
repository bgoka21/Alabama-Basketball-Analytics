{% extends 'admin/base.html' %}
{% from 'macros/table.html' import render_table %}
{% block content %}
<h1 class="text-3xl font-bold mb-6">Practice Leaderboards</h1>
{% if current_user.is_player %}
  <p class="mb-4">
    <a href="{{ url_for('admin.player_detail', player_name=current_user.player_name) }}" class="text-blue-600 underline">My Player Page</a>
  </p>
{% endif %}
<div class="mb-8 bg-white rounded-lg shadow-md p-4 sm:p-6">
  <form method="get" id="labelFilterForm" class="flex flex-col sm:flex-row flex-wrap gap-4 sm:items-end">
    <div class="flex flex-wrap gap-4">
      {% for lbl in label_options %}
        <label class="inline-flex items-center text-sm mr-2">
          <input type="checkbox" name="label" value="{{ lbl }}" {% if lbl in selected_labels %}checked{% endif %}>
          <span class="ml-1">{{ lbl }}</span>
        </label>
      {% endfor %}
    </div>
    <div>
      <label class="block text-sm font-medium mb-1">From</label>
      <input type="date" name="start_date" value="{{ request.args.get('start_date', '') }}" class="w-full border border-gray-300 rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#9E1B32]" />
    </div>
    <div>
      <label class="block text-sm font-medium mb-1">To</label>
      <input type="date" name="end_date" value="{{ request.args.get('end_date', '') }}" class="w-full border border-gray-300 rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#9E1B32]" />
    </div>
    <div class="flex items-end">
      <button type="submit" class="bg-[#9E1B32] hover:bg-[#7f1524] text-white px-5 py-2 rounded-md text-sm font-medium focus:outline-none focus:ring-2 focus:ring-[#9E1B32]">Apply</button>
    </div>
    <div class="flex items-end">
      <a href="{{ url_for('public.practice_homepage') }}" class="text-gray-600 hover:underline text-sm font-medium">Clear</a>
    </div>
  </form>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">

{% set dunk_cols = [
  {'key': 'player', 'label': 'Player', 'sortable': True, 'align': 'left', 'value_key': 'player_sort'},
  {'key': 'dunks', 'label': 'Dunks', 'sortable': True, 'align': 'right'},
] %}
<div class="space-y-4">
  <h2 class="text-xl font-semibold">Dunks Get You Paid</h2>
  {{ render_table(
      id='practice-dunks',
      columns=dunk_cols,
      rows=dunk_rows,
      totals=None,
      dense=True,
      sticky_header=True,
      caption='Dunks Get You Paid'
  ) }}
</div>

{% if show_poss_per_bcp %}
  {% set bcp_cols = [
    {'key': 'player', 'label': 'Player', 'sortable': True, 'align': 'left', 'value_key': 'player_sort'},
    {'key': 'bcp', 'label': 'BCP', 'sortable': True, 'align': 'right'},
    {'key': 'poss_per_bcp', 'label': 'Poss / BCP', 'sortable': True, 'align': 'right'},
    {'key': 'wins', 'label': 'Wins', 'sortable': True, 'align': 'right'},
  ] %}
{% else %}
  {% set bcp_cols = [
    {'key': 'player', 'label': 'Player', 'sortable': True, 'align': 'left', 'value_key': 'player_sort'},
    {'key': 'bcp', 'label': 'BCP', 'sortable': True, 'align': 'right'},
    {'key': 'wins', 'label': 'Wins', 'sortable': True, 'align': 'right'},
  ] %}
{% endif %}
<div class="space-y-4">
  <h2 class="text-xl font-semibold">Blue Collar Leaders</h2>
  {{ render_table(
      id='practice-bcp',
      columns=bcp_cols,
      rows=bcp_rows,
      totals=None,
      dense=True,
      sticky_header=True,
      caption='Blue Collar Leaders'
  ) }}
</div>

{% set atr_cols = [
  {'key': 'player', 'label': 'Player', 'sortable': True, 'align': 'left', 'value_key': 'player_sort'},
  {'key': 'fg', 'label': 'FG', 'sortable': True, 'align': 'right'},
  {'key': 'pct', 'label': 'ATR%', 'sortable': True, 'align': 'right'},
] %}
<div class="space-y-4">
  <h2 class="text-xl font-semibold">ATR% Leaders</h2>
  {{ render_table(
      id='practice-atr',
      columns=atr_cols,
      rows=atr_rows,
      totals=None,
      dense=True,
      sticky_header=True,
      caption='ATR% Leaders'
  ) }}
</div>

{% set fg3_cols = [
  {'key': 'player', 'label': 'Player', 'sortable': True, 'align': 'left', 'value_key': 'player_sort'},
  {'key': 'fg', 'label': 'FG', 'sortable': True, 'align': 'right'},
  {'key': 'pct', 'label': '3FG%', 'sortable': True, 'align': 'right'},
] %}
<div class="space-y-4">
  <h2 class="text-xl font-semibold">3FG% Leaders</h2>
  {{ render_table(
      id='practice-fg3',
      columns=fg3_cols,
      rows=fg3_rows,
      totals=fg3_totals,
      dense=True,
      sticky_header=True,
      caption='3FG% Leaders'
  ) }}
</div>

{% set pps_cols = [
  {'key': 'player', 'label': 'Player', 'sortable': True, 'align': 'left', 'value_key': 'player_sort'},
  {'key': 'pps', 'label': 'PPS', 'sortable': True, 'align': 'right'},
] %}
<div class="space-y-4">
  <h2 class="text-xl font-semibold">PPS Leaders</h2>
  {{ render_table(
      id='practice-pps',
      columns=pps_cols,
      rows=pps_rows,
      totals=None,
      dense=True,
      sticky_header=True,
      caption='PPS Leaders'
  ) }}
</div>

{% set record_cols = [
  {'key': 'player', 'label': 'Player', 'sortable': True, 'align': 'left', 'value_key': 'player_sort'},
  {'key': 'record', 'label': 'Record', 'sortable': True, 'align': 'left'},
  {'key': 'win_pct', 'label': 'Win%', 'sortable': True, 'align': 'right'},
] %}
<div class="space-y-4">
  <h2 class="text-xl font-semibold">Overall Record</h2>
  {{ render_table(
      id='practice-record',
      columns=record_cols,
      rows=overall_record_rows,
      totals=None,
      dense=True,
      sticky_header=True,
      caption='Overall Record'
  ) }}
</div>

{% set sprint_win_cols = [
  {'key': 'player', 'label': 'Player', 'sortable': True, 'align': 'left', 'value_key': 'player_sort'},
  {'key': 'wins', 'label': 'Wins', 'sortable': True, 'align': 'right'},
] %}
<div class="space-y-4">
  <h2 class="text-xl font-semibold">Sprint Wins</h2>
  {{ render_table(
      id='practice-sprint-wins',
      columns=sprint_win_cols,
      rows=sprint_win_rows,
      totals=None,
      dense=True,
      sticky_header=True,
      caption='Sprint Wins'
  ) }}
</div>

{% set sprint_loss_cols = [
  {'key': 'player', 'label': 'Player', 'sortable': True, 'align': 'left', 'value_key': 'player_sort'},
  {'key': 'losses', 'label': 'Losses', 'sortable': True, 'align': 'right'},
] %}
<div class="space-y-4">
  <h2 class="text-xl font-semibold">Sprint Losses</h2>
  {{ render_table(
      id='practice-sprint-losses',
      columns=sprint_loss_cols,
      rows=sprint_loss_rows,
      totals=None,
      dense=True,
      sticky_header=True,
      caption='Sprint Losses'
  ) }}
</div>

</div>
{% endblock %}
