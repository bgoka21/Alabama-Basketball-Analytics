{% extends 'admin/base.html' %}
{% from 'macros/table.html' import render_table %}
{% block content %}
<h1 class="text-3xl font-bold mb-4">Hard Hat Winners</h1>
<p class="text-gray-700 mb-6">Per-game Blue Collar Points leaders in wins, following the same filters as the homepage.</p>

<div class="flex flex-wrap gap-4 mb-6 items-start justify-between">
  <div class="flex flex-wrap gap-2">
    <a href="{{ url_for('public.hard_hat_detail', filter='season', game_type=selected_game_types, season_id=selected_season_id) }}"
       class="px-4 py-2 rounded {{ 'bg-[#9E1B32] text-white' if filter_opt=='season'  else 'bg-gray-200 text-black' }}">
      Season
    </a>
    <a href="{{ url_for('public.hard_hat_detail', filter='last5', game_type=selected_game_types, season_id=selected_season_id) }}"
       class="px-4 py-2 rounded {{ 'bg-[#9E1B32] text-white' if filter_opt=='last5'  else 'bg-gray-200 text-black' }}">
      Last 5 Games
    </a>
    <a href="{{ url_for('public.hard_hat_detail', filter='true_data', game_type=selected_game_types, season_id=selected_season_id) }}"
       class="px-4 py-2 rounded {{ 'bg-[#9E1B32] text-white' if filter_opt=='true_data' else 'bg-gray-200 text-black' }}">
      True Data
    </a>
  </div>

  {% if seasons %}
  <form method="get" class="flex flex-wrap gap-3 items-center">
    <input type="hidden" name="filter" value="{{ filter_opt }}">
    {% for gt in selected_game_types %}
      <input type="hidden" name="game_type" value="{{ gt }}">
    {% endfor %}
    <label for="season-select" class="text-sm font-semibold">Season:</label>
    <select id="season-select" name="season_id" class="rounded border-gray-300 text-sm px-3 py-2" onchange="this.form.submit()">
      {% for season in seasons %}
        <option value="{{ season.id }}" {% if season.id == selected_season_id %}selected{% endif %}>
          {{ season.season_name }}{% if season.id == current_season_id %} (Current){% endif %}
        </option>
      {% endfor %}
    </select>
  </form>
  {% endif %}
</div>

<form method="get" class="flex flex-wrap gap-3 items-center mb-6">
  <input type="hidden" name="filter" value="{{ filter_opt }}">
  <input type="hidden" name="season_id" value="{{ selected_season_id }}">
  <span class="text-sm font-semibold">Game Types:</span>
  <div class="flex flex-wrap gap-2">
    {% for option in game_type_options %}
      <label class="inline-flex items-center gap-2 text-sm bg-gray-100 px-3 py-1 rounded">
        <input
          type="checkbox"
          name="game_type"
          value="{{ option }}"
          class="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
          {% if option in selected_game_types %}checked{% endif %}
          onchange="this.form.submit()"
        >
        <span>{{ option }}</span>
      </label>
    {% endfor %}
  </div>
</form>

{% set hard_hat_cols = [
  {'key': 'game', 'label': 'Game', 'sortable': True, 'align': 'left'},
  {'key': 'date', 'label': 'Date', 'sortable': True, 'align': 'left', 'value_key': 'date_sort'},
  {'key': 'opponent', 'label': 'Opponent', 'sortable': True, 'align': 'left'},
  {'key': 'winner', 'label': 'Hard Hat Winner', 'sortable': True, 'align': 'left', 'value_key': 'winner_sort'},
  {'key': 'bcp', 'label': 'BCP', 'sortable': True, 'align': 'right'}
] %}

{{ render_table(
    id='hard-hat-detail',
    columns=hard_hat_cols,
    rows=hard_hat_rows,
    totals=None,
    dense=True,
    sticky_header=True,
    caption='Per-game Hard Hat winners'
) }}

{% if hard_hat_rows | length == 0 %}
  <div class="table-empty text-center text-sm text-gray-600 dark:text-gray-300 mt-3">No hard hats found for the selected filters.</div>
{% endif %}
{% endblock %}
