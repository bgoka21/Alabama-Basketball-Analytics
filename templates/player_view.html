{% extends 'base.html' %}
{% block content %}
<div id="print-area">
  <div class="max-w-screen-lg mx-auto px-4 sm:px-6 lg:px-8 p-4 sm:p-6 md:p-8">
    <div class="flex flex-col items-center text-center space-y-4 md:flex-row md:items-start md:space-y-0 md:space-x-6">
      <h1 class="text-2xl font-bold">{{ player.player_name }}</h1>
      <button id="downloadPdfBtn">Download PDF</button>
    </div>

  <h3 class="mt-6">On-Court Offensive Possessions &amp; Efficiency</h3>

  <div class="sm:hidden space-y-6">
    {% for category in shot_type_categories %}
      <div class="border rounded-lg p-4 bg-white">
        <h4 class="text-lg font-semibold mb-2">{{ category.name }}</h4>
        <table class="w-full text-sm">
          <tbody>
            <tr class="border-t border-gray-200">
              <th class="text-left py-2 px-3">Total</th>
              <td class="text-right py-2 px-3">
                {{ category.total.fga }} ● {{ category.total.fg_pct }} ● {{ category.total.pps }} ● {{ category.total.freq_pct }}
              </td>
            </tr>
            <tr class="border-t border-gray-200">
              <th class="text-left py-2 px-3">Transition</th>
              <td class="text-right py-2 px-3">
                {{ category.transition.fga }} ● {{ category.transition.fg_pct }} ● {{ category.transition.pps }} ● {{ category.transition.freq_pct }}
              </td>
            </tr>
            <tr class="border-t border-gray-200">
              <th class="text-left py-2 px-3">Half-Court</th>
              <td class="text-right py-2 px-3">
                {{ category.half_court.fga }} ● {{ category.half_court.fg_pct }} ● {{ category.half_court.pps }} ● {{ category.half_court.freq_pct }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    {% endfor %}
  </div>

  <div class="hidden sm:block overflow-x-auto">
    <table class="min-w-full">
    <tr><td>Possessions</td><td>{{ offensive_possessions }}</td></tr>
    <tr><td>PPP (On-court)</td><td>{{ ppp_on }}</td></tr>
    <tr><td>PPP (Off-court)</td><td>{{ ppp_off }}</td></tr>
    <tr><td>EFG%</td><td>{{ efg_on }}%</td></tr>
    <tr><td>ATR%</td><td>{{ atr_pct }}%</td></tr>
    <tr><td>2FG%</td><td>{{ two_fg_pct }}%</td></tr>
    <tr><td>3FG%</td><td>{{ three_fg_pct }}%</td></tr>
    <tr><td>Turnover Rate</td><td>{{ turnover_rate }}%</td></tr>
    <tr><td>Off-Reb Rate</td><td>{{ off_reb_rate }}%</td></tr>
    <tr><td>Fouls-Drawn Rate</td><td>{{ fouls_drawn_rate }}%</td></tr>
    </table>
  </div>

  {# Include shot type tables with sticky headers #}
    {% include "partials/shot_type_tables.html" with context %}
  </div>
</div>

<script>
function showTab(tabName) {
  ['seasonTotals','gameStats','shotType','skillDevelopment'].forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;
    el.classList.toggle('hidden', id !== tabName);
    el.classList.toggle('block',  id === tabName);
  });
  ['btnSeasonTotals','btnGameStats','btnShotType','btnSkillDevelopment'].forEach(btnId => {
    const b = document.getElementById(btnId);
    if (!b) return;
    if (btnId.toLowerCase().endsWith(tabName.toLowerCase())) {
      b.classList.add('bg-[#9E1B32]', 'text-white');
      b.classList.remove('border-gray-300','bg-white','text-gray-700');
    } else {
      b.classList.remove('bg-[#9E1B32]', 'text-white');
      b.classList.add('border-gray-300','bg-white','text-gray-700');
    }
  });
  window.location.hash = tabName;
  if (tabName === 'shotType') {
    showShotTypeDetail('atr');
  }
}

function showShotTypeDetail(detail) {
  ['atr','fg2','fg3'].forEach(id => {
    const el = document.getElementById(id);
    if (el) {
      el.classList.toggle('hidden', id !== detail);
      el.classList.toggle('block',  id === detail);
    }
  });
  const map = { atr:'ATR', fg2:'FG2', fg3:'FG3' };
  Object.entries(map).forEach(([type,suf]) => {
    const card = document.getElementById('card' + suf);
    if (!card) return;
    if (type === detail) {
      card.classList.replace('bg-white','bg-gray-100');
      card.classList.replace('dark:bg-gray-800','dark:bg-gray-700');
      card.classList.replace('shadow-md','shadow-inner');
    } else {
      card.classList.replace('bg-gray-100','bg-white');
      card.classList.replace('dark:bg-gray-700','dark:bg-gray-800');
      card.classList.replace('shadow-inner','shadow-md');
    }
  });
}

document.addEventListener('DOMContentLoaded', () => {
  showTab('shotType');
});

document.addEventListener('DOMContentLoaded', () => {
  const pdfBtn = document.getElementById('downloadPdfBtn');
  if (pdfBtn) {
    pdfBtn.addEventListener('click', () =>
      exportStatsPDF({ filename: `${player.player_name.replace(/\s+/g, '_')}.pdf` })
    );
  }
});
</script>

{% endblock %}
