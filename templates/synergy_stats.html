{% extends 'base.html' %}
{% block content %}
  <h1>Synergy Competition Stats</h1>
  <label for="competition" class="block mb-2">Competition:</label>
  <select id="competition" class="border p-2 mb-4"></select>
  <div id="games"></div>
  <script>
    async function loadCompetitions() {
      const res = await fetch('/api/competitions');
      const comps = await res.json();
      const select = document.getElementById('competition');
      select.innerHTML = comps.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
      if (select.options.length) {
        loadStats(select.value);
      }
    }
    async function loadStats(id) {
      const res = await fetch(`/api/stats?competition_id=${encodeURIComponent(id)}`);
      const games = await res.json();
      const div = document.getElementById('games');
      let html = '';
      for (const g of games) {
        html += `<h3 class="font-semibold mt-4">${g.date} - ${g.home_team} vs ${g.away_team}</h3>`;
        html += '<ul class="ml-4 list-disc">';
        for (const p of g.players) {
          html += `<li>${p.name}: ${p.points} pts, ${p.rebounds} reb, ${p.assists} ast</li>`;
        }
        html += '</ul>';
      }
      div.innerHTML = html;
    }
    document.getElementById('competition').addEventListener('change', e => loadStats(e.target.value));
    loadCompetitions();
  </script>
{% endblock %}
