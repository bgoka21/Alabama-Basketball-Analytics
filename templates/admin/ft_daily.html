{% extends 'admin/base.html' %}

{% block head %}
<style>
@media print {
  #sidebar, #mobile-menu-btn, .no-print { display: none !important; }
  @page { size: portrait; margin: 1in; }
  table { border-collapse: collapse; width: 100%; }
  th, td { border: 1px solid #000; }
}
</style>
{% endblock %}

{% block content %}
{% set date_str = selected_date.strftime('%B %d, %Y') %}

<div class="flex flex-col gap-4 mb-4">
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold flex items-center">
        Daily Free Throws
        <span class="ml-3 px-2 py-1 text-xs bg-gray-200 text-gray-700 rounded">Daily {{ date_str }}</span>
      </h1>
      <p class="text-sm text-gray-600">Report Date: {{ date_str }}</p>
    </div>
    {% if not print_mode %}
    <div class="space-x-2 no-print">
      <a href="{{ csv_url }}" class="bg-gray-200 text-gray-700 px-3 py-1 rounded text-sm">CSV</a>
      <button type="button" onclick="window.print()" class="bg-gray-200 text-gray-700 px-3 py-1 rounded text-sm">Print / Save PDF</button>
    </div>
    {% endif %}
  </div>

  {% if not print_mode %}
  <form method="get" class="flex flex-wrap items-end gap-4 no-print">
    <div>
      <label class="block text-sm font-medium mb-1">Date</label>
      <input type="date" name="date" value="{{ selected_date.isoformat() }}" class="border border-gray-300 rounded px-2 py-1" />
    </div>
    <label class="inline-flex items-center text-sm">
      <input type="checkbox" name="include_total" value="1" {% if include_total %}checked{% endif %} class="mr-2" />
      Include Total Shots (All Drills)
    </label>
    <label class="inline-flex items-center text-sm">
      <input type="checkbox" name="hide_zeros" value="1" {% if hide_zeros %}checked{% endif %} class="mr-2" />
      Hide players with 0 FT attempts
    </label>
    <div>
      <label class="block text-sm font-medium mb-1">Sort</label>
      <select name="sort" class="border border-gray-300 rounded px-2 py-1">
        <option value="attempts" {% if sort == 'attempts' %}selected{% endif %}>Attempts</option>
        <option value="makes" {% if sort == 'makes' %}selected{% endif %}>Makes</option>
        <option value="pct" {% if sort == 'pct' %}selected{% endif %}>FT %</option>
        {% if include_total %}<option value="total" {% if sort == 'total' %}selected{% endif %}>Total Shots</option>{% endif %}
        <option value="name" {% if sort == 'name' %}selected{% endif %}>Name</option>
      </select>
    </div>
    <div>
      <label class="block text-sm font-medium mb-1">Dir</label>
      <select name="dir" class="border border-gray-300 rounded px-2 py-1">
        <option value="asc" {% if dir == 'asc' %}selected{% endif %}>Asc</option>
        <option value="desc" {% if dir == 'desc' %}selected{% endif %}>Desc</option>
      </select>
    </div>
    <div>
      <button type="submit" class="bg-[#9E1B32] hover:bg-[#7f1524] text-white px-5 py-2 rounded">Apply</button>
    </div>
    <div>
      <a href="{{ url_for('admin.ft_daily') }}" class="text-gray-600 hover:underline text-sm">Reset</a>
    </div>
  </form>
  {% endif %}
</div>

{% if has_entries %}
<div class="overflow-x-auto">
  <table class="w-full table-auto border border-gray-200 rounded-md border-collapse">
    <thead>
        <tr class="bg-gray-200">
          <th class="px-4 py-2 text-left text-sm font-medium">
            <a href="{{ sort_urls.name }}" class="inline-flex items-center">Player{% if sort == 'name' %}<span class="ml-1 text-xs">{% if dir == 'asc' %}▲{% else %}▼{% endif %}</span>{% endif %}</a>
          </th>
          <th class="px-4 py-2 text-center text-sm font-medium">
            <a href="{{ sort_urls.makes }}" class="inline-flex items-center">FT Makes{% if sort == 'makes' %}<span class="ml-1 text-xs">{% if dir == 'asc' %}▲{% else %}▼{% endif %}</span>{% endif %}</a>
          </th>
          <th class="px-4 py-2 text-center text-sm font-medium">
            <a href="{{ sort_urls.attempts }}" class="inline-flex items-center">FT Attempts{% if sort == 'attempts' %}<span class="ml-1 text-xs">{% if dir == 'asc' %}▲{% else %}▼{% endif %}</span>{% endif %}</a>
          </th>
          <th class="px-4 py-2 text-center text-sm font-medium">
            <a href="{{ sort_urls.pct }}" class="inline-flex items-center">FT %{% if sort == 'pct' %}<span class="ml-1 text-xs">{% if dir == 'asc' %}▲{% else %}▼{% endif %}</span>{% endif %}</a>
          </th>
          {% if include_total %}
          <th class="px-4 py-2 text-center text-sm font-medium">
            <a href="{{ sort_urls.total }}" class="inline-flex items-center">Total Shots{% if sort == 'total' %}<span class="ml-1 text-xs">{% if dir == 'asc' %}▲{% else %}▼{% endif %}</span>{% endif %}</a>
          </th>
          {% endif %}
        </tr>
    </thead>
    <tbody>
      {% for row in rows %}
      <tr class="{{ loop.cycle('bg-white','bg-gray-50') }}">
        <td class="px-4 py-2 text-sm">{{ row.player_name }}</td>
        <td class="px-4 py-2 text-center text-sm">{{ row.ft_makes }}</td>
        <td class="px-4 py-2 text-center text-sm">{{ row.ft_attempts }}</td>
        <td class="px-4 py-2 text-center text-sm">{% if row.ft_attempts %}{{ '%.1f'|format(row.ft_pct) }}{% else %}—{% endif %}</td>
        {% if include_total %}<td class="px-4 py-2 text-center text-sm">{{ row.total_shots }}</td>{% endif %}
      </tr>
      {% endfor %}
    </tbody>
    <tfoot>
      <tr class="bg-gray-200 font-semibold">
        <td class="px-4 py-2 text-sm">Totals</td>
        <td class="px-4 py-2 text-center text-sm">{{ totals.ft_makes }}</td>
        <td class="px-4 py-2 text-center text-sm">{{ totals.ft_attempts }}</td>
        <td class="px-4 py-2 text-center text-sm">{% if totals.ft_attempts %}{{ '%.1f'|format(totals.ft_pct) }}{% else %}—{% endif %}</td>
        {% if include_total %}<td class="px-4 py-2 text-center text-sm">{{ totals.total_shots }}</td>{% endif %}
      </tr>
    </tfoot>
  </table>
</div>
{% else %}
<p class="text-center text-sm text-gray-500">No free throw entries for this date.</p>
{% endif %}

{% endblock %}

