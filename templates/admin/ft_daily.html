{% extends 'admin/base.html' %}

{% block head %}
<style>
@media print {
  #sidebar, #mobile-menu-btn, .no-print { display: none !important; }
  @page { size: portrait; margin: 1in; }
  table { border-collapse: collapse; width: 100%; }
  th, td { border: 1px solid #000; }
}
</style>
{% endblock %}

{% block content %}
{% set subtitle = 'Daily ' ~ start_date if start_date == end_date else 'From ' ~ start_date ~ ' to ' ~ end_date %}

<div class="flex flex-col gap-4 mb-4">
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold flex items-center">
        Daily Free Throws
        <span class="ml-3 px-2 py-1 text-xs bg-gray-200 text-gray-700 rounded">{{ subtitle }}</span>
      </h1>
      <p class="text-sm text-gray-600">Since {{ since_date }}</p>
    </div>
    {% if not print_mode %}
    <div class="space-x-2 no-print">
      <a href="{{ csv_url }}" class="bg-gray-200 text-gray-700 px-3 py-1 rounded text-sm">CSV</a>
      <button type="button" onclick="window.print()" class="bg-gray-200 text-gray-700 px-3 py-1 rounded text-sm">Print / Save PDF</button>
    </div>
    {% endif %}
  </div>

  {% if not print_mode %}
  <form method="get" class="flex flex-wrap items-end gap-4 no-print">
    <div>
      <label for="start-date" class="block text-sm font-medium mb-1">From</label>
      <input id="start-date" type="date" name="start_date" value="{{ start_date }}" class="border border-gray-300 rounded px-2 py-1" />
    </div>
    <div>
      <label for="end-date" class="block text-sm font-medium mb-1">To</label>
      <input id="end-date" type="date" name="end_date" value="{{ end_date }}" class="border border-gray-300 rounded px-2 py-1" />
    </div>
    <div>
      <label for="since-date" class="block text-sm font-medium mb-1">Since</label>
      <input id="since-date" type="date" name="since_date" value="{{ since_date }}" class="border border-gray-300 rounded px-2 py-1" />
    </div>
    <div class="flex items-center text-sm">
      <input id="hide-zeros" type="checkbox" name="hide_zeros" value="1" {% if hide_zeros %}checked{% endif %} class="mr-2" />
      <label for="hide-zeros">Hide players with 0 FT attempts</label>
    </div>
    <div>
      <label class="block text-sm font-medium mb-1">Sort</label>
      <select name="sort" class="border border-gray-300 rounded px-2 py-1">
        <option value="attempts" {% if sort == 'attempts' %}selected{% endif %}>FT Attempts</option>
        <option value="makes" {% if sort == 'makes' %}selected{% endif %}>FT Makes</option>
        <option value="pct" {% if sort == 'pct' %}selected{% endif %}>FT %</option>
        <option value="total" {% if sort == 'total' %}selected{% endif %}>Weekly Total Shots</option>
        <option value="name" {% if sort == 'name' %}selected{% endif %}>Name</option>
      </select>
    </div>
    <div>
      <label class="block text-sm font-medium mb-1">Dir</label>
      <select name="dir" class="border border-gray-300 rounded px-2 py-1">
        <option value="asc" {% if dir == 'asc' %}selected{% endif %}>Asc</option>
        <option value="desc" {% if dir == 'desc' %}selected{% endif %}>Desc</option>
      </select>
    </div>
    <div>
      <button type="submit" class="bg-[#9E1B32] hover:bg-[#7f1524] text-white px-5 py-2 rounded">Apply</button>
    </div>
    <div>
      <a href="{{ url_for('admin.ft_daily') }}" class="text-gray-600 hover:underline text-sm">Reset</a>
    </div>
  </form>
  {% endif %}
</div>

{% if has_entries %}
<div class="overflow-x-auto">
  <table class="w-full table-auto border border-gray-200 rounded-md border-collapse">
    <thead>
        <tr class="bg-gray-200">
          <th class="px-4 py-2 text-left text-sm font-medium">
            <a href="{{ sort_urls.name }}" class="inline-flex items-center">Player{% if sort == 'name' %}<span class="ml-1 text-xs">{% if dir == 'asc' %}▲{% else %}▼{% endif %}</span>{% endif %}</a>
          </th>
          <th class="px-4 py-2 text-center text-sm font-medium">Non-FT's</th>
          <th class="px-4 py-2 text-center text-sm font-medium">
            <a href="{{ sort_urls.makes }}" class="inline-flex items-center">FT Makes{% if sort == 'makes' %}<span class="ml-1 text-xs">{% if dir == 'asc' %}▲{% else %}▼{% endif %}</span>{% endif %}</a>
          </th>
          <th class="px-4 py-2 text-center text-sm font-medium">
            <a href="{{ sort_urls.attempts }}" class="inline-flex items-center">FT Attempts{% if sort == 'attempts' %}<span class="ml-1 text-xs">{% if dir == 'asc' %}▲{% else %}▼{% endif %}</span>{% endif %}</a>
          </th>
          <th class="px-4 py-2 text-center text-sm font-medium">
            <a href="{{ sort_urls.pct }}" class="inline-flex items-center">FT %{% if sort == 'pct' %}<span class="ml-1 text-xs">{% if dir == 'asc' %}▲{% else %}▼{% endif %}</span>{% endif %}</a>
          </th>
          <th class="px-4 py-2 text-center text-sm font-medium">
            <a href="{{ sort_urls.total }}" class="inline-flex items-center">Weekly Total Shots{% if sort == 'total' %}<span class="ml-1 text-xs">{% if dir == 'asc' %}▲{% else %}▼{% endif %}</span>{% endif %}</a>
          </th>
          <th class="px-4 py-2 text-center text-sm font-medium">FTM (Since {{ since_date }})</th>
          <th class="px-4 py-2 text-center text-sm font-medium">FTA (Since {{ since_date }})</th>
          <th class="px-4 py-2 text-center text-sm font-medium">FT% (Since {{ since_date }})</th>
          <th class="px-4 py-2 text-center text-sm font-medium">Total Shots (Since {{ since_date }})</th>
        </tr>
    </thead>
    <tbody>
      {% for row in rows %}
      <tr class="{{ loop.cycle('bg-white','bg-gray-50') }}">
        <td class="px-4 py-2 text-sm whitespace-nowrap">{{ row.player_name }}</td>
        <td class="px-4 py-2 text-center text-sm">{{ row.non_ft }}</td>
        <td class="px-4 py-2 text-center text-sm">{{ row.ft_makes }}</td>
        <td class="px-4 py-2 text-center text-sm">{{ row.ft_attempts }}</td>
        <td class="px-4 py-2 text-center text-sm">{% if row.ft_attempts %}{{ '%.1f'|format(row.ft_pct) }}{% else %}&mdash;{% endif %}</td>
        <td class="px-4 py-2 text-center text-sm">{{ row.total_shots_weekly }}</td>
        <td class="px-4 py-2 text-center text-sm">{{ row.ftm_since }}</td>
        <td class="px-4 py-2 text-center text-sm">{{ row.fta_since }}</td>
        <td class="px-4 py-2 text-center text-sm">{% if row.fta_since %}{{ '%.1f'|format(row.ft_pct_since) }}{% else %}&mdash;{% endif %}</td>
        <td class="px-4 py-2 text-center text-sm">{{ row.total_shots_since }}</td>
      </tr>
      {% endfor %}
    </tbody>
    <tfoot>
      <tr class="bg-gray-200 font-semibold">
        <td class="px-4 py-2 text-sm font-semibold">Totals</td>
        <td class="px-4 py-2 text-center text-sm font-semibold">{{ totals.non_ft }}</td>
        <td class="px-4 py-2 text-center text-sm font-semibold">{{ totals.ft_makes }}</td>
        <td class="px-4 py-2 text-center text-sm font-semibold">{{ totals.ft_attempts }}</td>
        <td class="px-4 py-2 text-center text-sm font-semibold">{% if totals.ft_attempts %}{{ '%.1f'|format(totals.ft_pct) }}{% else %}&mdash;{% endif %}</td>
        <td class="px-4 py-2 text-center text-sm font-semibold">{{ totals.total_shots_weekly }}</td>
        <td class="px-4 py-2 text-center text-sm font-semibold">{{ totals.ftm_since }}</td>
        <td class="px-4 py-2 text-center text-sm font-semibold">{{ totals.fta_since }}</td>
        <td class="px-4 py-2 text-center text-sm font-semibold">{% if totals.fta_since %}{{ '%.1f'|format(totals.ft_pct_since) }}{% else %}&mdash;{% endif %}</td>
        <td class="px-4 py-2 text-center text-sm font-semibold">{{ totals.total_shots_since }}</td>
      </tr>
    </tfoot>
  </table>
</div>
{% else %}
<p class="text-center text-sm text-gray-500">No free throw entries for this date.</p>
{% endif %}

{% endblock %}

