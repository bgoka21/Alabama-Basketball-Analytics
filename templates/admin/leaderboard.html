{% extends 'admin/base.html' %}

{% block page_controls %}
<form method="get" class="mb-4 flex flex-wrap items-end gap-4">
  <div>
    <label class="font-semibold mr-2">Season:</label>
    <select name="season_id" class="border p-2 rounded">
      {% for s in all_seasons %}
        <option value="{{ s.id }}" {% if s.id == selected_season %}selected{% endif %}>
          {{ s.season_name }}
        </option>
      {% endfor %}
    </select>
  </div>
  {% for key, values in request.args.lists() %}
    {% if key not in ['season_id', 'stat'] %}
      {% for v in values %}
        <input type="hidden" name="{{ key }}" value="{{ v }}">
      {% endfor %}
    {% endif %}
  {% endfor %}
  <input type="hidden" name="stat" value="{{ selected.key }}">
  <div>
    <button type="submit" class="bg-[#9E1B32] hover:bg-[#7f1524] text-white px-5 py-2 rounded">Apply</button>
  </div>
  <div>
    <a href="{{ url_for('admin.leaderboard') }}" class="text-gray-600 hover:underline text-sm">Clear</a>
  </div>
</form>
{% include "_filters_session.html" %}
{% endblock %}

{% block content %}
  <section class="mb-6">
    <h2 class="text-lg font-semibold text-gray-900">Practice Leaderboards</h2>
    <div class="mt-3 flex flex-wrap gap-3 text-sm">
      {% for link in practice_links %}
        {% set endpoint = link.endpoint %}
        {% set params = link.get('params', {}) %}
        {% set href_params = params.copy() %}
        {% if endpoint == 'admin.leaderboard' %}
          {% if selected_season %}
            {% set _ = href_params.update({'season_id': selected_season}) %}
          {% endif %}
          {% if start_date %}
            {% set _ = href_params.update({'start_date': start_date}) %}
          {% endif %}
          {% if end_date %}
            {% set _ = href_params.update({'end_date': end_date}) %}
          {% endif %}
        {% endif %}
        {% if selected_session %}
          {% set _ = href_params.update({'session': selected_session}) %}
        {% endif %}
        {% if selected_labels %}
          {% if 'label' in href_params %}
            {% set existing_label_value = href_params['label'] %}
            {% if existing_label_value is string %}
              {% set combined_labels = (selected_labels + [existing_label_value]) | unique %}
            {% else %}
              {% set combined_labels = (selected_labels + (existing_label_value | list)) | unique %}
            {% endif %}
            {% set _ = href_params.update({'label': combined_labels}) %}
          {% else %}
            {% set _ = href_params.update({'label': selected_labels}) %}
          {% endif %}
        {% endif %}
        {% set is_active = request.endpoint == endpoint %}
        {% if is_active and params %}
          {% for key, value in params.items() %}
            {% if request.args.get(key) != value %}
              {% set is_active = False %}
            {% endif %}
          {% endfor %}
        {% endif %}
        <a
          class="px-3 py-1 rounded-full border transition {{ 'bg-[#9E1B32] text-white border-[#9E1B32]' if is_active else 'border-gray-300 text-gray-700 hover:bg-white hover:text-[#9E1B32]' }}"
          href="{{ url_for(endpoint, **href_params) }}"
        >
          {{ link.label }}
        </a>
      {% endfor %}
    </div>
  </section>
  {% include "_leaderboard_block.html" %}

  <section class="mt-10 text-sm text-gray-600">
    <p>
      Want to build your own practice views? Check out the
      <a class="font-semibold text-[#9E1B32] hover:underline" href="/admin/custom-stats">Custom Stats Table</a>
      to mix and match roster, date, and stat filters on demand.
    </p>
  </section>
{% endblock %}
