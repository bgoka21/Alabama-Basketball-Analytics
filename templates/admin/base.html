<!DOCTYPE html>
<html lang="en" class="bg-white text-black">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alabama Basketball</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen flex">

  <!-- Mobile menu button -->
  <button id="mobile-menu-btn" class="md:hidden p-4 text-2xl">&#9776;</button>

  <!-- Sidebar -->
  <aside id="sidebar" class="hidden md:flex w-64 bg-[#9E1B32] text-white flex-col px-4 py-6">
    <h1 class="text-2xl font-bold mb-8">Alabama Basketball</h1>

    <nav class="flex flex-col gap-4 flex-1">
      <!-- Home -->
      <a href="{{ url_for('public.homepage') }}"
         class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {{ 'bg-white text-[#9E1B32]' if active_page=='home' else '' }}">
        Home
      </a>

      {% if current_user.is_authenticated %}

        {# ── Reports dropdown ── #}
        {% set reports_active = active_page in ['game_reports', 'practice_reports'] %}
        <details class="group" {% if reports_active %}open{% endif %}>
          <summary class="px-3 py-2 rounded cursor-pointer transition hover:bg-white hover:text-[#9E1B32]">
            Reports
          </summary>
          <div class="ml-4 mt-2 flex flex-col gap-2">
            <a href="{{ url_for('admin.game_reports') }}"
               class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {{ 'bg-white text-[#9E1B32]' if active_page=='game_reports' else '' }}">
              Game Reports
            </a>
            <a href="{{ url_for('admin.practice_reports') }}"
               class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {{ 'bg-white text-[#9E1B32]' if active_page=='practice_reports' else '' }}">
              Practice Reports
            </a>
          </div>
        </details>

        <!-- Players -->
        <a href="{{ url_for('admin.players_list') }}"
           class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {{ 'bg-white text-[#9E1B32]' if active_page=='players' else '' }}">
          Players
        </a>
        <a href="{{ url_for('admin.skill_totals') }}"
           class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {{ 'bg-white text-[#9E1B32]' if active_page=='skill_totals' else '' }}">
          Skill Totals
        </a>

        {% if current_user.is_admin %}
          {# ── Management dropdown ── #}
          {% set mgmt_active = active_page in ['dashboard', 'files', 'roster', 'users'] or request.blueprint == 'merge' %}
          <details class="group" {% if mgmt_active %}open{% endif %}>
            <summary class="px-3 py-2 rounded cursor-pointer transition hover:bg-white hover:text-[#9E1B32]">
              Management
            </summary>
            <div class="ml-4 mt-2 flex flex-col gap-2">
              <a href="{{ url_for('admin.dashboard') }}"
                 class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {{ 'bg-white text-[#9E1B32]' if active_page=='dashboard' else '' }}">
                Dashboard
              </a>
              <a href="{{ url_for('admin.files_view_unique') }}"
                 class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {{ 'bg-white text-[#9E1B32]' if active_page=='files' else '' }}">
                Files
              </a>
              <a href="{{ url_for('merge.merge_csv') }}"
                 class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {{ 'bg-white text-[#9E1B32]' if request.endpoint.startswith('merge.') else '' }}">
                Merge CSV
              </a>
              <a href="{{ url_for('admin.roster') }}"
                 class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {{ 'bg-white text-[#9E1B32]' if active_page=='roster' else '' }}">
                Roster
              </a>
              <a href="{{ url_for('admin.users_list') }}"
                 class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {{ 'bg-white text-[#9E1B32]' if active_page=='users' else '' }}">
                Users
              </a>
            </div>
          </details>
        {% endif %}

        <!-- Logout -->
        <a href="{{ url_for('admin.logout') }}"
           class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32]">
          Logout
        </a>
      {% else %}
        <!-- Login (for anonymous users) -->
        <a href="{{ url_for('admin.login') }}"
           class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32]">
          Login
        </a>
      {% endif %}
    </nav>
  </aside>

<!-- Main content -->
<main class="flex-1 p-6 overflow-y-auto bg-white text-black">
  {# ── Page-specific controls (e.g. season dropdown) ── #}
  {% block page_controls %}{% endblock %}

  {# ── Main page content ── #}
  {% block content %}{% endblock %}
</main>

  <script>
    const btn = document.getElementById('mobile-menu-btn');
    const sidebar = document.getElementById('sidebar');
    btn.addEventListener('click', () => {
      sidebar.classList.toggle('hidden');
    });
  </script>

</body>
</html>
