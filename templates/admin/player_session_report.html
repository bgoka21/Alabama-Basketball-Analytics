{% extends 'admin/base.html' %}
{% block content %}
<div class="p-6 bg-white rounded shadow">
  <h1 class="text-2xl font-bold mb-4">{{ player_name }} — Session Comparison</h1>

  <form method="get" class="mb-4 space-x-4">
    {% for lbl in all_labels %}
      <label class="inline-flex items-center text-sm mr-2">
        <input type="checkbox" name="labels" value="{{ lbl }}" {% if lbl in selected_labels %}checked{% endif %}>
        <span class="ml-1">{{ lbl }}</span>
      </label>
    {% endfor %}
    <button type="submit" class="bg-[#9E1B32] text-white px-3 py-1 rounded text-sm">Apply</button>
  </form>

  <div class="overflow-x-auto">
    <table class="min-w-full border">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-2 text-left">Stat</th>
          {% for sess in sessions %}
            <th class="px-4 py-2 text-center">
              {{ sess.name }}<br>
              <span class="text-sm text-gray-600">
                {{ sess.start_date.strftime('%b %-d') }}–{{ sess.end_date.strftime('%b %-d') }}
              </span>
            </th>
          {% endfor %}
          <th class="px-4 py-2 text-center">Overall</th>
        </tr>
      </thead>
      <tbody>
        {% set metrics = [
          ('efg_pct', 'Effective FG%', None),
          ('points_per_shot', 'PPP', None),
          ('atr_pct', 'ATR%', 'atr_freq_pct'),
          ('two_fg_pct', '2FG%', 'two_fg_freq_pct'),
          ('three_fg_pct', '3FG%', 'fg3_freq_pct'),
          ('assist_turnover_ratio', 'AST/TO', None),
          ('adj_assist_turnover_ratio', 'Adj AST/TO', None),
          ('offensive_possessions', 'Team Poss', None),
          ('ppp_on', 'PPP On', None),
          ('turnover_rate', 'TO Rate', None),
          ('individual_turnover_rate', 'Ind TO%', None),
          ('individual_off_reb_rate', 'Ind Off Reb%', None),
          ('fouls_drawn_rate', 'Ind Fouls Drawn%', None),
          ('steal', 'Steals', None),
          ('block', 'Blocks', None),
          ('deflection', 'Deflections', None),
          ('off_reb', 'Offensive Rebs', None),
          ('def_reb', 'Defensive Rebs', None),
          ('reb_tip', 'Reb Tips', None),
          ('charge_taken', 'Charges Taken', None),
          ('floor_dive', 'Floor Dives', None),
          ('total_blue_collar', 'Blue Collar Points', None)
        ] %}
        {% for key, label, freq_key in metrics %}
          <tr class="odd:bg-white even:bg-gray-50">
            <td class="px-4 py-2">{{ label }}</td>
            {% for sess in sessions %}
              {% set val = sess.stats[key] %}
              <td class="px-4 py-2 text-center {% if loop.index0 == 1 and improved[key] is not none %}{% if improved[key] %}text-green-600{% else %}text-red-600{% endif %}{% endif %}">
                {{ val }}
              </td>
            {% endfor %}
            <td class="px-4 py-2 text-center">{{ overall[key] }}</td>
          </tr>
          {% if freq_key %}
          <tr class="odd:bg-white even:bg-gray-50 text-sm text-gray-700">
            <td class="px-4 py-1">Freq %</td>
            {% for sess in sessions %}
              {% set val = sess.stats[freq_key] %}
              <td class="px-4 py-1 text-center {% if loop.index0 == 1 and improved[freq_key] is not none %}{% if improved[freq_key] %}text-green-600{% else %}text-red-600{% endif %}{% endif %}">
                {{ val }}
              </td>
            {% endfor %}
            <td class="px-4 py-1 text-center">{{ overall[freq_key] }}</td>
          </tr>
          {% endif %}
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
