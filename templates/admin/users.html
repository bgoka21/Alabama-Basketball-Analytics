{% extends 'admin/base.html' %}
{% from 'macros/table.html' import render_table %}

{% block content %}
  <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold">User Management</h1>
        <a href="{{ url_for('admin.logout') }}"
           class="px-4 py-2 bg-[#9E1B32] text-white rounded hover:bg-[#7a1524]">
          Logout
        </a>
      </div>

  <a href="{{ url_for('admin.add_user') }}"
     class="inline-block mb-4 px-4 py-2 bg-[#9E1B32] text-white rounded hover:bg-[#7a1524]">
    + Add New User
  </a>

  {% set columns = [
    {'key': 'username', 'label': 'User', 'sortable': True, 'align': 'left'},
    {'key': 'role', 'label': 'Role', 'sortable': True, 'align': 'left'},
    {'key': 'actions', 'label': 'Actions', 'sortable': False, 'align': 'center', 'width': 'w-32'}
  ] %}

  {% set table_rows = namespace(items=[]) %}
  {% for user in users %}
    {% if user.is_admin %}
      {% set role = 'Admin' %}
    {% elif user.is_player %}
      {% set role = 'Player (' ~ user.player_name ~ ')' %}
    {% else %}
      {% set role = 'User' %}
    {% endif %}

    {% set actions %}
      <div class="flex items-center justify-center gap-2">
        <a href="{{ url_for('admin.edit_user', user_id=user.id) }}" class="text-blue-600 hover:underline">Edit</a>
        <form action="{{ url_for('admin.delete_user', user_id=user.id) }}"
              method="POST"
              class="inline-block"
              onsubmit="return confirm('Delete {{ user.username }}?');">
          <button type="submit" class="text-red-600 hover:underline">Delete</button>
        </form>
      </div>
    {% endset %}

    {% set table_rows.items = table_rows.items + [{
      'username': user.username,
      'role': role,
      'actions': actions | safe
    }] %}
  {% endfor %}

  {{ render_table(
    id='admin-users',
    columns=columns,
    rows=table_rows.items,
    totals=None,
    dense=True,
    sticky_header=True,
    caption='User Management'
  ) }}

  {% if users|length == 0 %}
    <div class="table-empty text-center text-sm text-gray-600 dark:text-gray-300 mt-3">No users found.</div>
  {% endif %}
{% endblock %}
