{% extends 'admin/base.html' %}
{% block content %}
{# a default “empty” detail so missing categories don’t blow up #}
{% set empty_group = namespace(
  total     = namespace(attempts=0, makes=0, fg_pct=0, pps=0, freq=0),
  transition=namespace(attempts=0, makes=0, fg_pct=0, pps=0, freq=0),
  halfcourt =namespace(attempts=0, makes=0, fg_pct=0, pps=0, freq=0)
) %}

{% set agg  = (aggregated_game      if mode=='game' else aggregated_practice) %}
{% set blue = (player_blue_breakdown_game if mode=='game' else player_blue_breakdown_practice) %}


<div class="w-full p-6 bg-white dark:bg-gray-800 rounded-lg shadow-md">
  <h1 class="text-3xl font-bold mb-4">{{ player_name }} - Player Stats</h1>
  {% if not has_stats %}
    <p class="mb-4 text-yellow-600">No stats found for this player.</p>
  {% endif %}

<div class="w-full p-6 bg-white dark:bg-gray-800 rounded-lg shadow-md">

  <!-- Game/Practice Buttons -->
  <div class="flex gap-4 mb-4">
    <a href="{{ url_for('admin.player_detail', player_name=player_name, mode='game') }}"
       class="px-4 py-2 rounded {{ 'bg-[#9E1B32] text-white' if mode == 'game' else 'bg-gray-100 text-gray-800' }}">
      Game
    </a>
    <a href="{{ url_for('admin.player_detail', player_name=player_name, mode='practice') }}"
       class="px-4 py-2 rounded {{ 'bg-[#9E1B32] text-white' if mode == 'practice' else 'bg-gray-100 text-gray-800' }}">
      Practice
    </a>
  </div>
  
  <!-- Tab Buttons -->
  <div class="flex space-x-2 mb-4">
    <button
      id="btnSeasonTotals"
      onclick="showTab('seasonTotals')"
      class="px-4 py-2 border rounded"
    >
      Season Totals
    </button>
    <button
      id="btnGameStats"
      onclick="showTab('gameStats')"
      class="px-4 py-2 border rounded"
    >
      Game‑by‑Game Stats
    </button>
    <button
      id="btnShotType"
      onclick="showTab('shotType')"
      class="px-4 py-2 border rounded"
    >
      Shot Type
    </button>
    <button
    id="btnSkillDevelopment"
    onclick="showTab('skillDevelopment')"
    class="px-4 py-2 border rounded"
  >
    Skill Development
  </button>

  </div>

<!-- 1) Season Totals -->
<div id="seasonTotals" class="tab-content block">
  {# pick the right season‐totals & blue‐collar based on mode #}
  {% if mode == 'game' %}
    {% set agg  = aggregated_game %}
    {% set blue = player_blue_breakdown_game %}
  {% else %}
    {% set agg  = aggregated_practice %}
    {% set blue = player_blue_breakdown_practice %}
  {% endif %}

  <!-- Row 1: Advanced Shooting Metrics -->
  <div class="grid grid-cols-2 gap-4 mb-6 justify-items-center">
    <div class="bg-white dark:bg-gray-800 p-4 rounded shadow flex flex-col items-center w-80">
      <div class="text-sm font-medium text-gray-500 uppercase">PTS/SHOT</div>
      <div class="text-3xl font-bold mt-2">{{ agg.points_per_shot }}</div>
    </div>
    <div class="bg-white dark:bg-gray-800 p-4 rounded shadow flex flex-col items-center w-80">
      <div class="text-sm font-medium text-gray-500 uppercase">EFG%</div>
      <div class="text-3xl font-bold mt-2">{{ agg.efg_pct }}</div>
    </div>
  </div>

   <!-- Row 2: Shooting Breakdown -->
  <div class="grid grid-cols-4 gap-4 mb-6">
    <!-- ATR -->
    <div class="bg-white dark:bg-gray-800 p-4 rounded shadow flex flex-col items-center">
      <div class="text-sm font-medium text-gray-500 uppercase">ATR</div>
      <div class="text-3xl font-bold my-2">
        {% if agg.atr_attempts > 0 %}
          {{ (agg.atr_makes/agg.atr_attempts*100)|round(1) }}%
        {% else %}0%{% endif %}
      </div>
      <div class="text-xs text-gray-500">{{ agg.atr_makes }}/{{ agg.atr_attempts }}</div>
    </div>
    <!-- 2FG -->
    <div class="bg-white dark:bg-gray-800 p-4 rounded shadow flex flex-col items-center">
      <div class="text-sm font-medium text-gray-500 uppercase">2FG</div>
      <div class="text-3xl font-bold my-2">
        {% if agg.fg2_attempts > 0 %}
          {{ (agg.fg2_makes/agg.fg2_attempts*100)|round(1) }}%
        {% else %}0%{% endif %}
      </div>
      <div class="text-xs text-gray-500">{{ agg.fg2_makes }}/{{ agg.fg2_attempts }}</div>
    </div>
    <!-- 3FG -->
    <div class="bg-white dark:bg-gray-800 p-4 rounded shadow flex flex-col items-center">
      <div class="text-sm font-medium text-gray-500 uppercase">3FG</div>
      <div class="text-3xl font-bold my-2">
        {% if agg.fg3_attempts > 0 %}
          {{ (agg.fg3_makes/agg.fg3_attempts*100)|round(1) }}%
        {% else %}0%{% endif %}
      </div>
      <div class="text-xs text-gray-500">{{ agg.fg3_makes }}/{{ agg.fg3_attempts }}</div>
    </div>
    <!-- FT -->
    <div class="bg-white dark:bg-gray-800 p-4 rounded shadow flex flex-col items-center">
      <div class="text-sm font-medium text-gray-500 uppercase">FT</div>
      <div class="text-3xl font-bold my-2">
        {% if agg.fta > 0 %}
          {{ (agg.ftm/agg.fta*100)|round(1) }}%
        {% else %}0%{% endif %}
      </div>
      <div class="text-xs text-gray-500">{{ agg.ftm }}/{{ agg.fta }}</div>
    </div>
  </div>


  <!-- Row 3: Totals -->
  <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
    {% for label, value in [
      ('Points', agg.points),
      ('Assists', agg.assists),
      ('Pot. Assists', agg.pot_assists),
      ('2nd Assists', agg.second_assists),
      ('Turnovers', agg.turnovers)
    ] %}
      <div class="bg-white dark:bg-gray-800 p-4 rounded shadow flex flex-col items-center">
        <div class="text-sm font-medium text-gray-500 uppercase">{{ label }}</div>
        <div class="text-2xl font-bold mt-2">{{ value }}</div>
      </div>
    {% endfor %}
  </div>

  <!-- Row 4: Ratios -->
  <div class="grid grid-cols-2 gap-4 mb-6 justify-items-center">
    <div class="bg-white dark:bg-gray-800 p-4 rounded shadow flex flex-col items-center w-80">
      <div class="text-sm font-medium text-gray-500 uppercase">AST/TO Ratio</div>
      <div class="text-2xl font-bold mt-2">{{ agg.assist_turnover_ratio }}</div>
    </div>
    <div class="bg-white dark:bg-gray-800 p-4 rounded shadow flex flex-col items-center w-80">
      <div class="text-sm font-medium text-gray-500 uppercase">Adj AST/TO</div>
      <div class="text-2xl font-bold mt-2">{{ agg.adj_assist_turnover_ratio }}</div>
    </div>
  </div>

  <!-- Blue Collar Breakdown -->
  <div class="mt-8">
    <h2 class="text-xl font-semibold mb-4">Blue Collar Breakdown</h2>
    <div class="overflow-x-auto">
      <table class="min-w-full table-auto border-collapse bg-white dark:bg-gray-800 shadow rounded-lg mb-6">
        <thead class="bg-white dark:bg-gray-800 border-b-2 border-[#9E1B32]">
          <tr>
            <th class="px-4 py-2 text-left text-xs font-medium uppercase">Category</th>
            <th class="px-4 py-2 text-left text-xs font-medium uppercase">Total</th>
          </tr>
        </thead>
        <tbody>
          {% for label, value in [
            ('Def Reb',      blue.def_reb),
            ('Off Reb',      blue.off_reb),
            ('Misc',         blue.misc),
            ('Deflection',   blue.deflection),
            ('Steal',        blue.steal),
            ('Block',        blue.block),
            ('Floor Dive',   blue.floor_dive),
            ('Charge Taken', blue.charge_taken)
          ] %}
          <tr class="odd:bg-white even:bg-gray-100">
            <td class="px-4 py-2">{{ label }}</td>
            <td class="px-4 py-2">{{ value }}</td>
          </tr>
          {% endfor %}

          {# Divider before the Season Total row #}
          <tr class="h-0">
            <td colspan="2" class="p-0">
              <div class="h-[2px] bg-[#9E1B32]"></div>
            </td>
          </tr>
          <tr class="odd:bg-white even:bg-gray-100 font-bold">
            <td class="px-4 py-2">Season Total</td>
            <td class="px-4 py-2">{{ blue.total_blue_collar }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

</div>  <!-- closes <div id="seasonTotals"> -->



<!-- 2) Game-by-Game / Practice-by-Practice Stats -->
<div id="gameStats" class="tab-content hidden">
  <h2 class="text-xl font-semibold mb-2">
    {% if mode == 'game' %}
      Game-by-Game Breakdown
    {% else %}
      Practice-by-Practice Breakdown
    {% endif %}
  </h2>
  <div class="overflow-x-auto">
    <table
      id="gameStatsTable"
      class="min-w-full table-auto border-collapse bg-white dark:bg-gray-800 shadow rounded-lg"
    >
      <thead class="bg-white dark:bg-gray-800 border-b-2 border-[#9E1B32]">
        <tr>
          <th class="px-4 py-2 text-left text-xs font-medium uppercase whitespace-nowrap" data-sort-key="game_date" style="cursor:pointer;">
            Date<span class="sort-indicator ml-2">⇅</span>
          </th>
          <th class="px-4 py-2 text-left text-xs font-medium uppercase">Opponent</th>
          <th class="px-4 py-2 text-left text-xs font-medium uppercase" data-sort-key="points" style="cursor:pointer;">
            Pts<span class="sort-indicator ml-2"></span>
          </th>
          <th class="px-4 py-2 text-left text-xs font-medium uppercase" data-sort-key="assists" style="cursor:pointer;">
            Ast<span class="sort-indicator ml-2"></span>
          </th>
          <th class="px-4 py-2 text-left text-xs font-medium uppercase">Pot. Ast</th>
          <th class="px-4 py-2 text-left text-xs font-medium uppercase" data-sort-key="turnovers" style="cursor:pointer;">
            TO's<span class="sort-indicator ml-2"></span>
          </th>
          <th class="px-4 py-2 text-left text-xs font-medium uppercase">ATR</th>
          <th class="px-4 py-2 text-left text-xs font-medium uppercase" data-sort-key="atr_pct" style="cursor:pointer;">
            ATR%<span class="sort-indicator ml-2"></span>
          </th>
          <th class="px-4 py-2 text-left text-xs font-medium uppercase">2FG</th>
          <th class="px-4 py-2 text-left text-xs font-medium uppercase" data-sort-key="fg2_pct" style="cursor:pointer;">
            2FG%<span class="sort-indicator ml-2"></span>
          </th>
          <th class="px-4 py-2 text-left text-xs font-medium uppercase">3FG</th>
          <th class="px-4 py-2 text-left text-xs font-medium uppercase" data-sort-key="fg3_pct" style="cursor:pointer;">
            3FG%<span class="sort-indicator ml-2"></span>
          </th>
          <th class="px-4 py-2 text-left text-xs font-medium uppercase">FT</th>
          <th class="px-4 py-2 text-left text-xs font-medium uppercase" data-sort-key="ft_pct" style="cursor:pointer;">
            FT%<span class="sort-indicator ml-2"></span>
          </th>
        </tr>
      </thead>

      {# pick the right dicts based on mode #}
      {% if mode == 'game' %}
        {% set breakdown = game_breakdown %}
        {% set details   = game_details %}
      {% else %}
        {% set breakdown = practice_breakdown %}
        {% set details   = practice_details %}
      {% endif %}

      <tbody>
        {% for id, row in breakdown.items() %}
          {% set dt = details.get(id, {'game_date':'','opponent_name':'','sort_date':'0'}) %}
          <tr class="odd:bg-white even:bg-gray-100">
            <td class="px-4 py-2" data-sort="{{ dt.sort_date }}">{{ dt.game_date }}</td>
            <td class="px-4 py-2">{{ dt.opponent_name }}</td>
            <td class="px-4 py-2">{{ row.points }}</td>
            <td class="px-4 py-2">{{ row.assists }}</td>
            <td class="px-4 py-2">{{ row.pot_assists }}</td>
            <td class="px-4 py-2">{{ row.turnovers }}</td>
            <td class="px-4 py-2">{{ row.atr_makes }}/{{ row.atr_attempts }}</td>
            <td class="px-4 py-2">
              {% if row.atr_attempts > 0 %}
                {{ (row.atr_makes/row.atr_attempts*100)|round(1) }}%
              {% else %}0%{% endif %}
            </td>
            <td class="px-4 py-2">{{ row.fg2_makes }}/{{ row.fg2_attempts }}</td>
            <td class="px-4 py-2">
              {% if row.fg2_attempts > 0 %}
                {{ (row.fg2_makes/row.fg2_attempts*100)|round(1) }}%
              {% else %}0%{% endif %}
            </td>
            <td class="px-4 py-2">{{ row.fg3_makes }}/{{ row.fg3_attempts }}</td>
            <td class="px-4 py-2">
              {% if row.fg3_attempts > 0 %}
                {{ (row.fg3_makes/row.fg3_attempts*100)|round(1) }}%
              {% else %}0%{% endif %}
            </td>
            <td class="px-4 py-2">{{ row.ftm }}/{{ row.fta }}</td>
            <td class="px-4 py-2">
              {% if row.fta > 0 %}
                {{ (row.ftm/row.fta*100)|round(1) }}%
              {% else %}0%{% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>



  <!-- Shot Type Section -->
  <div id="shotType" class="tab-content hidden">
  <h2 class="text-xl font-semibold mb-4">Shot Type Overview</h2>

  <!-- Season Aggregates as big cards -->
  <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
    <!-- ATR Season -->
    <div
      id="cardATR"
      onclick="showShotTypeDetail('atr')"
      class="cursor-pointer bg-white dark:bg-gray-800 p-4 rounded shadow-md transition"
      style="{{ shot_type_totals.atr.fg_pct|round(1)
                |grade_atr2fg_pct(shot_type_totals.atr.attempts) }}"
    >
      <div class="text-sm font-medium text-gray-500 uppercase">ATR Season</div>
      <div class="text-2xl font-bold mt-2">
        {{ shot_type_totals.atr.fg_pct|round(1) }}%
      </div>
      <div class="text-xs text-gray-500">
        {{ shot_type_totals.atr.makes }}/{{ shot_type_totals.atr.attempts }}
      </div>
    </div>

    <!-- 2FG Season -->
    <div
      id="cardFG2"
      onclick="showShotTypeDetail('fg2')"
      class="cursor-pointer bg-white dark:bg-gray-800 p-4 rounded shadow-md transition"
      style="{{ shot_type_totals.fg2.fg_pct|round(1)
                |grade_atr2fg_pct(shot_type_totals.fg2.attempts) }}"
    >
      <div class="text-sm font-medium text-gray-500 uppercase">2FG Season</div>
      <div class="text-2xl font-bold mt-2">
        {{ shot_type_totals.fg2.fg_pct|round(1) }}%
      </div>
      <div class="text-xs text-gray-500">
        {{ shot_type_totals.fg2.makes }}/{{ shot_type_totals.fg2.attempts }}
      </div>
    </div>

    <!-- 3FG Season -->
    <div
      id="cardFG3"
      onclick="showShotTypeDetail('fg3')"
      class="cursor-pointer bg-white dark:bg-gray-800 p-4 rounded shadow-md transition"
      style="{{ shot_type_totals.fg3.fg_pct|round(1)
                |grade_3fg_pct(shot_type_totals.fg3.attempts) }}"
    >
      <div class="text-sm font-medium text-gray-500 uppercase">3FG Season</div>
      <div class="text-2xl font-bold mt-2">
        {{ shot_type_totals.fg3.fg_pct|round(1) }}%
      </div>
      <div class="text-xs text-gray-500">
        {{ shot_type_totals.fg3.makes }}/{{ shot_type_totals.fg3.attempts }}
      </div>
    </div>
  </div>

  <!-- (no more small buttons here—click the big cards above!) -->


    {# pull in our three namespaces from the route #}
    {% set atr_summary = shot_summaries['atr'] %}
    {% set fg2_summary = shot_summaries['fg2'] %}
    {% set fg3_summary = shot_summaries['fg3'] %}
    
    
    {# ── ATR Detail Table ── #}
    {% set atr_groups = [
      ('Assisted',        ['Assisted','Non-Assisted']),
      ('Dribble',      ['Dribble','No Dribble']),
      ('RA',           ['Restricted Area','Non Restricted Area']),
      ('Feet',         ['Off 1 Foot','Off 2 Feet']),
      ('Hands',        ['Left Hand Finish','Right Hand Finish','Hands To Rim','Hands Away From Rim']),
      ('PA',           ['Play Action','No Play Action']),
      ('Defenders',    ['Primary Defender','Secondary Defender','Multiple Defenders','Unguarded']),
      ('Type',         ['Dunk','Catch','Floater','Layup','Pull Up','Step Back']),
      ('Other',        ['Blocked']),
      ('Scheme – Drive',  ['Middle Drive','Baseline Drive','Slot Drive','Drive Right','Drive Left']),
      ('Scheme – Attack', ['Beast / Post','DHO / Get','Iso','PnR Handler','Off Closeout','PnR Sneak','Transition Push','OREB Putback']),
      ('Scheme – Pass',   [
        'Swing','Check Down','Off Screen','1 More','Lift','PnR Pocket','Post Entry','Drift','PnR Lob','Post Pass Out','Kickdown',
        'PnR Late Roll','Dump Off','Slot Skip','Pocket Extra','Lob','Nail Pitch','DHO / Get','PnR Pop','Slash / Cut','Reshape',
        'Shake','Skip','Pull Behind','Outlet','Press Break','Cross Court','Under OB','Kick Ahead','Dagger','Side / Press OB'
      ])
    ] %}
    
    <div id="atr" class="detail-content hidden">
      <table class="min-w-full divide-y divide-gray-200 mb-6">
        <thead class="bg-gray-100">
          <tr>
            <th rowspan="2" class="px-4 py-2 text-left">Category</th>
            <th colspan="4" class="px-4 py-2 text-center">Total</th>
            <th colspan="4" class="px-4 py-2 text-center">Transition</th>
            <th colspan="4" class="px-4 py-2 text-center">Half-Court</th>
          </tr>
          <tr>
            {% for _ in range(3) %}
              <th class="px-2 py-1 text-center">FGA</th>
              <th class="px-2 py-1 text-center">FG%</th>
              <th class="px-2 py-1 text-center">PPS</th>
              <th class="px-2 py-1 text-center">Freq%</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          {% for _group_name, cats in atr_groups %}
            {# crimson divider between groups #}
            <tr>
              <td colspan="13" class="p-0">
                <div class="h-[2px] bg-[#9E1B32]"></div>
              </td>
            </tr>
    
            {# actual data rows with zebra stripes #}
            {% for category in cats %}
              {% set d = atr_summary.cats.get(category, empty_group) %}
              <tr class="{{ loop.cycle('', 'bg-gray-100') }}">
                <td class="px-4 py-2">{{ category }}</td>
    
                {# Totals #}
                <td class="px-2 py-1 text-center">
                  {{ d.total.makes }}-{{ d.total.attempts }}
                </td>
                <td
                  class="px-2 py-1 text-center"
                  style="{{ (d.total.fg_pct*100)|round(1)|grade_atr2fg_pct(d.total.attempts) }}"
                >
                  {{ (d.total.fg_pct*100)|round(1) }}%
                </td>
                <td class="px-2 py-1 text-center">
                  {{ d.total.pps|round(2) }}
                </td>
                <td class="px-2 py-1 text-center">
                  {% if shot_type_totals.atr.attempts > 0 %}
                    {{ (d.total.attempts / shot_type_totals.atr.attempts * 100) | round(1) }}%
                  {% else %}
                    0.0%
                  {% endif %}
                </td>
    
                {# Transition #}
                <td class="px-2 py-1 text-center">
                  {{ d.transition.makes }}-{{ d.transition.attempts }}
                </td>
                <td
                  class="px-2 py-1 text-center"
                  style="{{ (d.transition.fg_pct*100)|round(1)|grade_atr2fg_pct(d.transition.attempts) }}"
                >
                  {{ (d.transition.fg_pct*100)|round(1) }}%
                </td>
                <td class="px-2 py-1 text-center">
                  {{ d.transition.pps|round(2) }}
                </td>
                <td class="px-2 py-1 text-center">
                  {% if shot_type_totals.atr.attempts > 0 %}
                    {{ (d.transition.attempts / shot_type_totals.atr.attempts * 100) | round(1) }}%
                  {% else %}
                    0.0%
                  {% endif %}
                </td>
    
                {# Half-Court #}
                <td class="px-2 py-1 text-center">
                  {{ d.halfcourt.makes }}-{{ d.halfcourt.attempts }}
                </td>
                <td
                  class="px-2 py-1 text-center"
                  style="{{ (d.halfcourt.fg_pct*100)|round(1)|grade_atr2fg_pct(d.halfcourt.attempts) }}"
                >
                  {{ (d.halfcourt.fg_pct*100)|round(1) }}%
                </td>
                <td class="px-2 py-1 text-center">
                  {{ d.halfcourt.pps|round(2) }}
                </td>
                <td class="px-2 py-1 text-center">
                  {% if shot_type_totals.atr.attempts > 0 %}
                    {{ (d.halfcourt.attempts / shot_type_totals.atr.attempts * 100) | round(1) }}%
                  {% else %}
                    0.0%
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          {% endfor %}
        </tbody>
      </table>
    </div>

    
    {# ── 2FG Detail Table ── #}
    {% set fg2_groups = [
      ('Assisted',        ['Assisted','Non-Assisted']),
      ('Dribble',         ['Dribble','No Dribble']),
      ('RA',              ['Restricted Area','Non Restricted Area']),
      ('Feet',            ['Off 1 Foot','Off 2 Feet']),
      ('Hands',           ['Left Hand Finish','Right Hand Finish','Hands To Rim','Hands Away From Rim']),
      ('PA',              ['Play Action','No Play Action']),
      ('Defenders',       ['Primary Defender','Secondary Defender','Multiple Defenders','Unguarded']),
      ('Type',            ['Dunk','Catch','Floater','Layup','Pull Up','Step Back']),
      ('Other',           ['Blocked']),
      ('Scheme – Drive',  ['Middle Drive','Baseline Drive','Slot Drive','Drive Right','Drive Left']),
      ('Scheme – Attack', ['Beast / Post','DHO / Get','Iso','PnR Handler','Off Closeout','PnR Sneak','Transition Push','OREB Putback']),
      ('Scheme – Pass',   [
        'Swing','Check Down','Off Screen','1 More','Lift','PnR Pocket','Post Entry','Drift','PnR Lob','Post Pass Out','Kickdown',
        'PnR Late Roll','Dump Off','Slot Skip','Pocket Extra','Lob','Nail Pitch','DHO / Get','PnR Pop','Slash / Cut','Reshape',
        'Shake','Skip','Pull Behind','Outlet','Press Break','Cross Court','Under OB','Kick Ahead','Dagger','Side / Press OB'
      ])
    ] %}
    
    <div id="fg2" class="detail-content hidden">
      <table class="min-w-full divide-y divide-gray-200 mb-6">
        <thead class="bg-gray-100">
          <tr>
            <th rowspan="2" class="px-4 py-2 text-left">Category</th>
            <th colspan="4" class="px-4 py-2 text-center">Total</th>
            <th colspan="4" class="px-4 py-2 text-center">Transition</th>
            <th colspan="4" class="px-4 py-2 text-center">Half-Court</th>
          </tr>
          <tr>
            {% for _ in range(3) %}
              <th class="px-2 py-1 text-center">FGA</th>
              <th class="px-2 py-1 text-center">FG%</th>
              <th class="px-2 py-1 text-center">PPS</th>
              <th class="px-2 py-1 text-center">Freq%</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          {% for _group_name, cats in fg2_groups %}
            <tr>
              <td colspan="13" class="p-0">
                <div class="h-[2px] bg-[#9E1B32]"></div>
              </td>
            </tr>
            {% for category in cats %}
              {% set d = fg2_summary.cats.get(category, empty_group) %}
              <tr class="{{ loop.cycle('', 'bg-gray-100') }}">
                <td class="px-4 py-2">{{ category }}</td>
    
                {# Totals #}
                <td class="px-2 py-1 text-center">{{ d.total.makes }}-{{ d.total.attempts }}</td>
                <td class="px-2 py-1 text-center"{% if d.total.attempts > 0 %} style="{{ (d.total.makes / d.total.attempts * 100) | round(1) | grade_atr2fg_pct(d.total.attempts) }}"{% endif %}>
                  {% if d.total.attempts > 0 %}{{ (d.total.makes / d.total.attempts * 100) | round(1) }}%{% else %}0.0%{% endif %}
                </td>
                <td class="px-2 py-1 text-center">{{ d.total.pps | round(2) }}</td>
                <td class="px-2 py-1 text-center">
                  {% if shot_type_totals.fg2.attempts > 0 %}
                    {{ (d.total.attempts / shot_type_totals.fg2.attempts * 100) | round(1) }}%
                  {% else %}0.0%{% endif %}
                </td>
    
                {# Transition #}
                <td class="px-2 py-1 text-center">{{ d.transition.makes }}-{{ d.transition.attempts }}</td>
                <td class="px-2 py-1 text-center"{% if d.transition.attempts > 0 %} style="{{ (d.transition.makes / d.transition.attempts * 100) | round(1) | grade_atr2fg_pct(d.transition.attempts) }}"{% endif %}>
                  {% if d.transition.attempts > 0 %}{{ (d.transition.makes / d.transition.attempts * 100) | round(1) }}%{% else %}0.0%{% endif %}
                </td>
                <td class="px-2 py-1 text-center">{{ d.transition.pps | round(2) }}</td>
                <td class="px-2 py-1 text-center">
                  {% if shot_type_totals.fg2.attempts > 0 %}
                    {{ (d.transition.attempts / shot_type_totals.fg2.attempts * 100) | round(1) }}%
                  {% else %}0.0%{% endif %}
                </td>
    
                {# Half-Court #}
                <td class="px-2 py-1 text-center">{{ d.halfcourt.makes }}-{{ d.halfcourt.attempts }}</td>
                <td class="px-2 py-1 text-center"{% if d.halfcourt.attempts > 0 %} style="{{ (d.halfcourt.makes / d.halfcourt.attempts * 100) | round(1) | grade_atr2fg_pct(d.halfcourt.attempts) }}"{% endif %}>
                  {% if d.halfcourt.attempts > 0 %}{{ (d.halfcourt.makes / d.halfcourt.attempts * 100) | round(1) }}%{% else %}0.0%{% endif %}
                </td>
                <td class="px-2 py-1 text-center">{{ d.halfcourt.pps | round(2) }}</td>
                <td class="px-2 py-1 text-center">
                  {% if shot_type_totals.fg2.attempts > 0 %}
                    {{ (d.halfcourt.attempts / shot_type_totals.fg2.attempts * 100) | round(1) }}%
                  {% else %}0.0%{% endif %}
                </td>
              </tr>
            {% endfor %}
          {% endfor %}
        </tbody>
      </table>
    </div>
    

    
    {# ── 3FG Detail Table ── #}
    {% set fg3_groups = [
      ('Assisted',        ['Assisted','Non-Assisted']),
      ('Type',            ['Catch and Shoot','Pull Up','Step Back','Catch and Hold','Slide Dribble']),
      ('Line',            ['On The Line','Off The Line']),
      ('Pocket',          ['Shot Pocket','Non-Shot Pocket']),
      ('Move',            ['Stationary','On Move']),
      ('Contest',         ['Contest','Uncontested','Late Contest','Blocked']),
      ('Footwork',        ['WTN Left-Right','WTN Right-Left','Left-Right','Right-Left','Hop']),
      ('Good/Bad',        ['Good','Bad','Neutral Three']),
      ('Shrink',          ['Shrink','Non-Shrink']),
      ('Scheme – Attack', ['Beast / Post','DHO / Get','PnR Handler','Iso','Off Closeout','PnR Sneak','Transition Push','OREB Putback']),
      ('Scheme – Drive',  ['Drive Right','Drive Left','Dip']),
      ('Scheme – Pass',   [
        'Swing','Checkdown','Off Screen','1 More','Lift','Drift','Post Entry','Post Pass Out',
        'Kickdown','Slot Skip','Pocket Extra','Lob','Nail Pitch','DHO / Get','PnR Pop','Reshape','Shake','Skip',
        'Pull Behind','Outlet','Press Break','Cross Court','Under OB','Kick Ahead','Dagger','Side / Press OB'
      ])
    ] %}
    
    <div id="fg3" class="detail-content hidden">
      <table class="min-w-full divide-y divide-gray-200 mb-6">
        <thead class="bg-gray-100">
          <tr>
            <th rowspan="2" class="px-4 py-2 text-left">Category</th>
            <th colspan="4" class="px-4 py-2 text-center">Total</th>
            <th colspan="4" class="px-4 py-2 text-center">Transition</th>
            <th colspan="4" class="px-4 py-2 text-center">Half-Court</th>
          </tr>
          <tr>
            {% for _ in range(3) %}
              <th class="px-2 py-1 text-center">FGA</th>
              <th class="px-2 py-1 text-center">FG%</th>
              <th class="px-2 py-1 text-center">PPS</th>
              <th class="px-2 py-1 text-center">Freq%</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          {% for _group_name, cats in fg3_groups %}
            <tr>
              <td colspan="13" class="p-0">
                <div class="h-[2px] bg-[#9E1B32]"></div>
              </td>
            </tr>
            {% for category in cats %}
              {% set d = fg3_summary.cats.get(category, empty_group) %}
              <tr class="{{ loop.cycle('', 'bg-gray-100') }}">
                <td class="px-4 py-2">{{ category }}</td>
    
                {# Totals #}
                <td class="px-2 py-1 text-center">{{ d.total.makes }}-{{ d.total.attempts }}</td>
                <td class="px-2 py-1 text-center"{% if d.total.attempts > 0 %} style="{{ (d.total.makes / d.total.attempts * 100) | round(1) | grade_3fg_pct(d.total.attempts) }}"{% endif %}>
                  {% if d.total.attempts > 0 %}{{ (d.total.makes / d.total.attempts * 100) | round(1) }}%{% else %}0.0%{% endif %}
                </td>
                <td class="px-2 py-1 text-center">{{ d.total.pps | round(2) }}</td>
                <td class="px-2 py-1 text-center">
                  {% if shot_type_totals.fg3.attempts > 0 %}
                    {{ (d.total.attempts / shot_type_totals.fg3.attempts * 100) | round(1) }}%
                  {% else %}0.0%{% endif %}
                </td>
    
                {# Transition #}
                <td class="px-2 py-1 text-center">{{ d.transition.makes }}-{{ d.transition.attempts }}</td>
                <td class="px-2 py-1 text-center"{% if d.transition.attempts > 0 %} style="{{ (d.transition.makes / d.transition.attempts * 100) | round(1) | grade_3fg_pct(d.transition.attempts) }}"{% endif %}>
                  {% if d.transition.attempts > 0 %}{{ (d.transition.makes / d.transition.attempts * 100) | round(1) }}%{% else %}0.0%{% endif %}
                </td>
                <td class="px-2 py-1 text-center">{{ d.transition.pps | round(2) }}</td>
                <td class="px-2 py-1 text-center">
                  {% if shot_type_totals.fg3.attempts > 0 %}
                    {{ (d.transition.attempts / shot_type_totals.fg3.attempts * 100) | round(1) }}%
                  {% else %}0.0%{% endif %}
                </td>
    
                {# Half-Court #}
                <td class="px-2 py-1 text-center">{{ d.halfcourt.makes }}-{{ d.halfcourt.attempts }}</td>
                <td class="px-2 py-1 text-center"{% if d.halfcourt.attempts > 0 %} style="{{ (d.halfcourt.makes / d.halfcourt.attempts * 100) | round(1) | grade_3fg_pct(d.halfcourt.attempts) }}"{% endif %}>
                  {% if d.halfcourt.attempts > 0 %}{{ (d.halfcourt.makes / d.halfcourt.attempts * 100) | round(1) }}%{% else %}0.0%{% endif %}
                </td>
                <td class="px-2 py-1 text-center">{{ d.halfcourt.pps | round(2) }}</td>
                <td class="px-2 py-1 text-center">
                  {% if shot_type_totals.fg3.attempts > 0 %}
                    {{ (d.halfcourt.attempts / shot_type_totals.fg3.attempts * 100) | round(1) }}%
                  {% else %}0.0%{% endif %}
                </td>
              </tr>
            {% endfor %}
          {% endfor %}
        </tbody>
      </table>
    </div>
    </div>
    
  
<!-- ──────────────────────────────────────────────────────────────────────────── -->
<!-- 4) Skill Development                                                           -->
<!-- ──────────────────────────────────────────────────────────────────────────── -->
<div
  id="skillDevelopment"
  class="tab-content hidden px-6 py-8 bg-gray-50 rounded-lg shadow-lg mb-8"
>
  <!-- ─── Section Title ──────────────────────────────────────────────────────── -->
  <h2 class="text-3xl font-bold mb-6 border-b pb-2">Skill Development</h2>

  <!-- ─── Drill-by-Drill Entry Form (ATR / Floater / 3FG / FT) ─────────────────── -->
  {% if current_user.is_admin %}
  <div class="mb-8 bg-white rounded-lg shadow-md p-6">
    <h3 class="text-2xl font-semibold mb-4">Drill-by-Drill Entry</h3>
    <form method="post" class="w-full">
      <div class="overflow-x-auto">
        <table class="w-full table-fixed border border-gray-200 rounded-md">
          <thead>
            <!-- Top header: Date + shot-class groups -->
            <tr class="bg-gray-100">
              <th
                rowspan="2"
                class="px-3 py-2 text-left text-sm font-medium border-r border-gray-200"
              >
                Date
              </th>
              {% for key, subs in shot_map.items() %}
                <th
                  colspan="{{ subs|length }}"
                  class="px-3 py-2 text-center text-sm font-medium border-r border-gray-200"
                >
                  {{ label_map[key] }}
                </th>
              {% endfor %}
            </tr>
            <!-- Sub-headers: each sub-category -->
            <tr class="bg-gray-100">
              {% for subs in shot_map.values() %}
                {% for sub in subs %}
                  <th
                    class="px-2 py-1 text-xs font-medium border-r border-gray-200"
                  >
                    {{ sub }}
                  </th>
                {% endfor %}
              {% endfor %}
            </tr>
          </thead>

          <tbody>
            <tr class="bg-white">
              <!-- Date picker -->
              <td class="px-3 py-2 border-t border-gray-200">
                <input
                  type="date"
                  name="date"
                  required
                  class="w-full border border-gray-300 rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#9E1B32]"
                />
              </td>
              <!-- One input cell per sub-category -->
              {% for key, subs in shot_map.items() %}
                {% for sub in subs %}
                  <td class="px-2 py-2 border-t border-gray-200">
                    <div class="flex space-x-1 justify-center">
                      <input
                        type="number"
                        min="0"
                        name="{{ key }}_{{ sub|replace(' ', '_') }}_makes"
                        placeholder="M"
                        class="w-12 border border-gray-300 rounded-md p-1 text-sm focus:outline-none focus:ring-2 focus:ring-[#9E1B32]"
                      />
                      <input
                        type="number"
                        min="0"
                        name="{{ key }}_{{ sub|replace(' ', '_') }}_attempts"
                        placeholder="A"
                        class="w-12 border border-gray-300 rounded-md p-1 text-sm focus:outline-none focus:ring-2 focus:ring-[#9E1B32]"
                      />
                    </div>
                  </td>
                {% endfor %}
              {% endfor %}
            </tr>
            <tr class="bg-gray-50">
              <td
                colspan="{{ 1 + (shot_map.values()|map('length')|sum) }}"
                class="px-3 py-3 text-right border-t border-gray-200"
              >
                <button
                  type="submit"
                  class="bg-[#9E1B32] hover:bg-[#7f1524] text-white px-5 py-2 rounded-md text-sm font-medium focus:outline-none focus:ring-2 focus:ring-[#9E1B32]"
                >
                  Save All
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </form>
  </div>
  {% endif %}
  {% if current_user.is_admin %}

  <!-- ─── “NBA 100” Entry Form ──────────────────────────────────────────────────── -->
  <div class="mb-8 bg-white rounded-lg shadow-md p-6">
    <h3 class="text-2xl font-semibold mb-4">NBA 100 Exercise</h3>
    <form
      method="post"
      action="{{ url_for('admin.add_nba100_entry', player_name=player_name) }}"
      class="grid grid-cols-1 sm:grid-cols-3 gap-4"
    >
      <div>
        <label class="block text-sm font-medium mb-1">Date</label>
        <input
          type="date"
          name="date"
          required
          class="w-full border border-gray-300 rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
      </div>
      <div>
        <label class="block text-sm font-medium mb-1"
          >Makes (out of 100)</label
        >
        <input
          type="number"
          name="makes"
          min="0"
          max="100"
          required
          placeholder="e.g. 87"
          class="w-full border border-gray-300 rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
      </div>
      <div class="flex items-end">
        <button
          type="submit"
          class="bg-[#9E1B32] hover:bg-[#7f1524] text-white px-5 py-2 rounded-md text-sm font-medium focus:outline-none focus:ring-2 focus:ring-[#9E1B32]"
        >
          Save NBA 100
        </button>
      </div>
    </form>
  </div>
  {% endif %}

  <!-- ─── Date-Range Filter Form ──────────────────────────────────────────────── -->
  <div class="mb-8 bg-white rounded-lg shadow-md p-6">
    <h3 class="text-2xl font-semibold mb-4">Filter History</h3>
    <form method="get" class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-6">
      <div class="flex-1">
        <label class="block text-sm font-medium mb-1">From</label>
        <input
          type="date"
          name="start_date"
          value="{{ start_date }}"
          class="w-full border border-gray-300 rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#9E1B32]"
        />
      </div>
      <div class="flex-1">
        <label class="block text-sm font-medium mb-1">To</label>
        <input
          type="date"
          name="end_date"
          value="{{ end_date }}"
          class="w-full border border-gray-300 rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#9E1B32]"
        />
      </div>
      <div class="flex items-end">
        <button
          type="submit"
          class="bg-[#9E1B32] hover:bg-[#7f1524] text-white px-5 py-2 rounded-md text-sm font-medium focus:outline-none focus:ring-2 focus:ring-[#9E1B32]"
        >
          Apply
        </button>
      </div>
      <div class="flex items-end">
        <a
          href="{{ url_for('admin.player_detail', player_name=player_name) }}"
          class="text-gray-600 hover:underline text-sm font-medium"
          >Clear</a
        >
      </div>
    </form>
  </div>

  <!-- ─── Drill History Table ─────────────────────────────────────────────────── -->
  <div class="mb-8">
    <h3 class="text-2xl font-semibold mb-4">Drill History</h3>
    <div class="overflow-x-auto bg-white rounded-lg shadow-md p-4">
      <table class="w-full table-fixed border border-gray-200 rounded-md">
        <thead>
          <tr class="bg-gray-200">
            <th
              rowspan="2"
              class="px-4 py-2 text-left text-sm font-medium border-r border-gray-300"
            >
              Date
            </th>
            {% for key, subs in shot_map.items() %}
              <th
                colspan="{{ subs|length }}"
                class="px-4 py-2 text-center text-sm font-medium border-r border-gray-300"
              >
                {{ label_map[key] }}
              </th>
            {% endfor %}
          </tr>
          <tr class="bg-gray-200">
            {% for subs in shot_map.values() %}
              {% for sub in subs %}
                <th class="px-3 py-1 text-xs font-medium border-r border-gray-300">
                  {{ sub }}
                </th>
              {% endfor %}
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          <!-- Totals Row -->
          <tr class="bg-gray-100 font-semibold">
            <td class="px-4 py-2 text-sm border-t border-gray-300">Totals</td>
            {% for key, subs in shot_map.items() %}
              {% for sub in subs %}
                {% set t = shot_totals[key][sub] %}
                <td class="px-3 py-2 text-center text-sm border-t border-gray-300">
                  {{ t.makes }}/{{ t.attempts }}
                </td>
              {% endfor %}
            {% endfor %}
          </tr>

          <!-- Per-date Drill Rows -->
          {% for entry_date, items_grouped in entries|groupby('date') %}
            <tr class="{{ loop.cycle('bg-white','bg-gray-50') }}">
              <td class="px-4 py-3 align-top text-sm border-t border-gray-300">
                {{ entry_date.strftime('%b %d, %Y') }}
                {% if current_user.is_admin %}
                <div class="mt-1 space-x-2 text-xs">
                  <a
                    href="{{ url_for('admin.edit_skill_entry', player_name=player_name, entry_date=entry_date.isoformat()) }}"
                    class="text-blue-600 hover:underline">Edit</a>
                  <form
                    action="{{ url_for('admin.delete_skill_entry', player_name=player_name, entry_date=entry_date.isoformat()) }}"
                    method="post"
                    class="inline">
                    <button
                      type="submit"
                      class="text-red-600 hover:underline"
                      onclick="return confirm('Delete this entire entry?');">
                      Delete
                    </button>
                  </form>
                </div>
                {% endif %}
              </td>
              {% for key, subs in shot_map.items() %}
                {% for sub in subs %}
                  {% set drill_entry = items_grouped
                       | selectattr('shot_class','equalto', key)
                       | selectattr('subcategory','equalto', sub)
                       | list | first %}
                  <td class="px-3 py-2 text-center text-sm border-t border-gray-300">
                    {% if drill_entry %}
                      {{ drill_entry.makes }}/{{ drill_entry.attempts }}<br />
                      <span class="text-xs text-gray-600">
                        ({{ drill_entry.fg_pct }}%)
                      </span>
                    {% else %}
                      &mdash;
                    {% endif %}
                  </td>
                {% endfor %}
              {% endfor %}
            </tr>
          {% else %}
            <tr>
              <td
                colspan="{{ 1 + (shot_map.values()|map('length')|sum) }}"
                class="px-4 py-3 text-center text-sm text-gray-500 border-t border-gray-300"
              >
                No drill history yet.
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- ─── NBA 100 History Table ────────────────────────────────────────────────── -->
  <div class="mb-4">
    <h3 class="text-2xl font-semibold mb-4">NBA 100 History</h3>
    <div class="overflow-x-auto bg-white rounded-lg shadow-md p-4">
      <table class="w-full table-fixed border border-gray-200 rounded-md">
        <thead>
          <tr class="bg-gray-200">
            <th class="px-4 py-2 text-left text-sm font-medium border-r border-gray-300">
              Date
            </th>
            <th class="px-4 py-2 text-left text-sm font-medium border-r border-gray-300">
              Makes (out of 100)
            </th>
          </tr>
        </thead>
        <tbody>
          {% for n in nba100_entries %}
            <tr class="{{ loop.cycle('bg-white','bg-gray-50') }}">
              <td class="px-4 py-2 text-sm border-t border-gray-300">
                {{ n.date.strftime('%b %d, %Y') }}
              </td>
              <td class="px-4 py-2 text-sm border-t border-gray-300">
                {{ n.value }}/100
              </td>
            </tr>
          {% else %}
            <tr>
              <td
                colspan="2"
                class="px-4 py-3 text-center text-sm text-gray-500 border-t border-gray-300"
              >
                No NBA 100 entries yet.
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

</div>  <!-- /.inner container -->
</div>  <!-- /.main container -->


  <script>
// —— Utility ——
function capitalize(str) {
  return str.charAt(0).toUpperCase() + str.slice(1);
}

// —— Main tab switcher ——
function showTab(tabName) {
  ['seasonTotals','gameStats','shotType','skillDevelopment'].forEach(id => {
    const el = document.getElementById(id);
    el.classList.toggle('hidden', id !== tabName);
    el.classList.toggle('block',  id === tabName);
  });
  ['btnSeasonTotals','btnGameStats','btnShotType','btnSkillDevelopment'].forEach(btnId => {
    document.getElementById(btnId).classList.remove('bg-[#9E1B32]','text-white');
  });
  document.getElementById('btn' + capitalize(tabName)).classList.add('bg-[#9E1B32]','text-white');

  if (tabName === 'shotType') {
    showShotTypeDetail('atr');  // default into ATR whenever you open ShotType
  }
}


// —— Shot‑Type sub‑tab switcher ——
function showShotTypeDetail(detail) {
  ['atr','fg2','fg3'].forEach(id => {
    const el = document.getElementById(id);
    el.classList.toggle('hidden', id !== detail);
    el.classList.toggle('block',  id === detail);
  });
  const map = { atr:'ATR', fg2:'FG2', fg3:'FG3' };
  Object.entries(map).forEach(([type,suf]) => {
    const card = document.getElementById('card' + suf);
    if (type === detail) {
      card.classList.replace('bg-white','bg-gray-100');
      card.classList.replace('dark:bg-gray-800','dark:bg-gray-700');
      card.classList.replace('shadow-md','shadow-inner');
    } else {
      card.classList.replace('bg-gray-100','bg-white');
      card.classList.replace('dark:bg-gray-700','dark:bg-gray-800');
      card.classList.replace('shadow-inner','shadow-md');
    }
  });
}


  // —— DOM-ready initialization ——
  document.addEventListener('DOMContentLoaded', () => {
    // pull the hash (without the leading “#”)
    const hash = window.location.hash.slice(1);
    // if it matches one of our tab IDs, show it, otherwise default
    if (['seasonTotals','gameStats','shotType','skillDevelopment'].includes(hash)) {
      showTab(hash);
    } else {
      showTab('seasonTotals');
    }

  // 2) Wire up Game‑by‑Game sorting
  const table = document.getElementById("gameStatsTable");
  if (table) {
    const headers = table.querySelectorAll("thead th[data-sort-key]");
    let sortState = { key: null, order: 'asc' };
    headers.forEach(header => {
      const indicator = header.querySelector(".sort-indicator");
      if (indicator) indicator.textContent = " ⇅";
      header.addEventListener("click", () => {
        const sortKey = header.getAttribute("data-sort-key");
        if (sortState.key === sortKey) {
          sortState.order = (sortState.order === "asc" ? "desc" : "asc");
        } else {
          sortState.key = sortKey;
          sortState.order = (sortKey === "game_date" ? "desc" : "asc");
        }
        // restyle headers
        headers.forEach(h => h.classList.remove("bg-[#9E1B32]","text-white"));
        headers.forEach(h => {
          const ind = h.querySelector(".sort-indicator");
          if (ind) ind.textContent = " ⇅";
        });
        header.classList.add("bg-blue-600","text-white");
        if (indicator) indicator.textContent = (sortState.order === "asc" ? " ▲" : " ▼");
        // actually sort
        const sortMapping = {
          "game_date":0, "points":2, "assists":3,
          "pot_assists":4, "turnovers":5,
          "atr_pct":7, "fg2_pct":9, "fg3_pct":11, "ft_pct":13
        };
        const colIndex = sortMapping[sortKey];
        const tbody = table.tBodies[0];
        Array.from(tbody.rows)
             .sort((a,b) => {
               let aVal, bVal;
               if (sortKey === "game_date") {
                 aVal = parseInt(a.cells[colIndex].getAttribute("data-sort"))||0;
                 bVal = parseInt(b.cells[colIndex].getAttribute("data-sort"))||0;
               } else {
                 const strip = s=>parseFloat(s.textContent.trim().replace(/%$/,""))||0;
                 aVal = strip(a.cells[colIndex]);
                 bVal = strip(b.cells[colIndex]);
               }
               return sortState.order==="asc" ? aVal - bVal : bVal - aVal;
             })
             .forEach(r=>tbody.appendChild(r));
      });
    });
  }
});
</script>





{% endblock %}
