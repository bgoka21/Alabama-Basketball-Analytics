{# mark Recruiting menu open when we're in the recruits blueprint #}
{% import '_macros/icons.html' as icons %}
{% set recruiting_active = request.endpoint and request.endpoint.startswith('recruits.') %}
{% set recruit_list_url = url_for('recruits.list_recruits') if view_exists('recruits.list_recruits') else '#' %}
{% set money_board_url = url_for('recruits.money_board') if view_exists('recruits.money_board') else '#' %}
{% set link_base_classes = "nav-link group flex w-full items-center gap-3 px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32]" %}
{% set active_classes = "bg-white/20 text-white font-semibold border-l-4 border-white shadow-inner" %}
{% set summary_base_classes = "nav-link flex w-full items-center gap-3 px-3 py-2 rounded transition cursor-pointer hover:bg-white hover:text-[#9E1B32]" %}
{% set summary_active_classes = "group-open:bg-white/20 group-open:text-white group-open:font-semibold group-open:border-l-4 group-open:border-white group-open:shadow-inner" %}
<ul class="flex flex-col gap-2">
  {% if current_user.is_player %}
  <li class="nav-item">
    <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.player_detail' %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.player_detail', player_name=current_user.player_name) }}">
      {{ icons.render('profile') }}
      <span class="flex-1 text-left">My Page</span>
    </a>
  </li>
  <li class="nav-item">
    <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.logout' %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.logout') }}">
      {{ icons.render('logout') }}
      <span class="flex-1 text-left">Logout</span>
    </a>
  </li>
  {% else %}
  {% set home_url = url_for('public.game_homepage') if view_exists('public.game_homepage') else (url_for('public.homepage') if view_exists('public.homepage') else '#') %}
  <li class="nav-item">
    <a class="{{ link_base_classes }}{% if request.endpoint in ['public.game_homepage','public.homepage'] %} {{ active_classes }}{% endif %}" href="{{ home_url }}">
      {{ icons.render('home') }}
      <span class="flex-1 text-left">Home</span>
    </a>
  </li>
  {% set reports_active = request.endpoint in ['admin.game_reports', 'admin.practice_reports', 'advanced_offense_report', 'playcall_report'] %}
  <li class="nav-item">
    <details class="group" {% if reports_active %}open{% endif %}>
      <summary class="{{ summary_base_classes }} {{ summary_active_classes }}">
        {{ icons.render('reports') }}
        <span class="flex-1 text-left">Reports</span>
        <svg class="ml-auto h-4 w-4 shrink-0 transition-transform duration-200 group-open:-rotate-180" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.585l3.71-3.354a.75.75 0 111.02 1.1l-4.25 3.846a.75.75 0 01-1.02 0L5.21 8.33a.75.75 0 01.02-1.12z" clip-rule="evenodd" />
        </svg>
      </summary>
      <div class="ml-4 mt-0 group-open:mt-2 bg-white/10 border border-white/20 rounded-lg px-3 py-2 transition-all flex flex-col space-y-1 opacity-0 -translate-y-1 group-open:opacity-100 group-open:translate-y-0">
        <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.game_reports' %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.game_reports') }}">
          {{ icons.render('reports') }}
          <span class="flex-1 text-left">Game Reports</span>
        </a>
        <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.practice_reports' %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.practice_reports') }}">
          {{ icons.render('practice') }}
          <span class="flex-1 text-left">Practice Reports</span>
        </a>
        {% if ADVANCED_POSSESSION_ENABLED %}
        {# BEGIN Advanced Possession #}
        <a class="{{ link_base_classes }}{% if request.endpoint == 'advanced_offense_report' %} {{ active_classes }}{% endif %}" href="{{ url_for('advanced_offense_report') }}">
          {{ icons.render('analytics') }}
          <span class="flex-1 text-left">Advanced Possession Report</span>
        </a>
        {# END Advanced Possession #}
        {% endif %}
        {% if PLAYCALL_REPORT_ENABLED %}
        {# BEGIN Playcall Report #}
        <a class="{{ link_base_classes }}{% if request.endpoint == 'playcall_report' %} {{ active_classes }}{% endif %}" href="{{ url_for('playcall_report') }}">
          {{ icons.render('clipboard') }}
          <span class="flex-1 text-left">Playcall Report</span>
        </a>
        <a class="{{ link_base_classes }}" href="https://www.tideinfinity.com/scout/playcalls" target="_blank" rel="noopener noreferrer">
          {{ icons.render('clipboard') }}
          <span class="flex-1 text-left">Scout Playcall Report</span>
        </a>
        {# END Playcall Report #}
        {% endif %}
      </div>
    </details>
  </li>
  <li class="nav-item">
    <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.players_list' %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.players_list') }}">
      {{ icons.render('players') }}
      <span class="flex-1 text-left">Players</span>
    </a>
  </li>
  <li class="nav-item">
    <details class="group" {% if recruiting_active %}open{% endif %}>
      <summary class="{{ summary_base_classes }} {{ summary_active_classes }}">
        {{ icons.render('recruiting') }}
        <span class="flex-1 text-left">Recruiting</span>
        <svg class="ml-auto h-4 w-4 shrink-0 transition-transform duration-200 group-open:-rotate-180" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.585l3.71-3.354a.75.75 0 111.02 1.1l-4.25 3.846a.75.75 0 01-1.02 0L5.21 8.33a.75.75 0 01.02-1.12z" clip-rule="evenodd" />
        </svg>
      </summary>
      <div class="ml-4 mt-0 group-open:mt-2 bg-white/10 border border-white/20 rounded-lg px-3 py-2 transition-all flex flex-col space-y-1 opacity-0 -translate-y-1 group-open:opacity-100 group-open:translate-y-0">
        <a class="{{ link_base_classes }}{% if request.endpoint and request.endpoint.startswith('recruits.') and request.endpoint != 'recruits.money_board' and not request.endpoint.startswith('recruits.money_coach') %} {{ active_classes }}{% endif %}"
           href="{{ recruit_list_url }}">
          {{ icons.render('recruiting') }}
          <span class="flex-1 text-left">Recruits</span>
        </a>

        <a class="{{ link_base_classes }}{% if request.endpoint in ['recruits.money_board','recruits.money_coach'] %} {{ active_classes }}{% endif %}"
           href="{{ money_board_url }}">
          {{ icons.render('currency') }}
          <span class="flex-1 text-left">Money Board</span>
        </a>
      </div>
    </details>
  </li>
  <li class="nav-item">
    <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.skill_totals' %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.skill_totals') }}">
      {{ icons.render('totals') }}
      <span class="flex-1 text-left">Skill Totals</span>
    </a>
  </li>
  <li class="nav-item">
    <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.ft_daily' %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.ft_daily') }}">
      {{ icons.render('free-throws') }}
      <span class="flex-1 text-left">Daily Free Throws</span>
    </a>
  </li>
  {% set has_team_totals = (view_exists('admin.team_totals') if view_exists is defined else True) %}
  {% set team_totals_url = url_for('admin.team_totals') if has_team_totals else '#' %}
  <li class="nav-item">
    <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.team_totals' %} {{ active_classes }}{% endif %}" href="{{ team_totals_url }}">
      {{ icons.render('totals') }}
      <span class="flex-1 text-left">Team Totals</span>
    </a>
  </li>
  {% set leaderboard_endpoints = ['admin.leaderboard', 'admin.leaderboard_game'] %}
  {% set leaderboards_active = request.endpoint in leaderboard_endpoints %}
  <li class="nav-item">
    <details class="group" {% if leaderboards_active %}open{% endif %}>
      <summary class="{{ summary_base_classes }} {{ summary_active_classes }}">
        {{ icons.render('leaderboard') }}
        <span class="flex-1 text-left">Leaderboards</span>
        <svg class="ml-auto h-4 w-4 shrink-0 transition-transform duration-200 group-open:-rotate-180" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.585l3.71-3.354a.75.75 0 111.02 1.1l-4.25 3.846a.75.75 0 01-1.02 0L5.21 8.33a.75.75 0 01.02-1.12z" clip-rule="evenodd" />
        </svg>
      </summary>
      <div class="ml-4 mt-0 group-open:mt-2 bg-white/10 border border-white/20 rounded-lg px-3 py-2 transition-all flex flex-col space-y-1 opacity-0 -translate-y-1 group-open:opacity-100 group-open:translate-y-0">
        <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.leaderboard' %} {{ active_classes }}{% endif %}"
           href="{{ url_for('admin.leaderboard') }}">
          {{ icons.render('leaderboard') }}
          <span class="flex-1 text-left">Practice Leaderboard</span>
        </a>
        <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.leaderboard_game' %} {{ active_classes }}{% endif %}"
           href="{{ url_for('admin.leaderboard_game') }}">
          {{ icons.render('leaderboard') }}
          <span class="flex-1 text-left">Game Leaderboard</span>
        </a>
      </div>
    </details>
  </li>
  {% set summer_url = url_for('public.summer_stats') if view_exists('public.summer_stats') else '#' %}
  <li class="nav-item">
    <a class="{{ link_base_classes }}{% if request.endpoint == 'public.summer_stats' %} {{ active_classes }}{% endif %}" href="{{ summer_url }}">
      {{ icons.render('summer') }}
      <span class="flex-1 text-left">Summer Stats</span>
    </a>
  </li>
  {% include '_partials/sidebar_management.html' %}
  {% if current_user.is_authenticated %}
  <li class="nav-item">
    <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.logout' %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.logout') }}">
      {{ icons.render('logout') }}
      <span class="flex-1 text-left">Logout</span>
    </a>
  </li>
  {% else %}
  <li class="nav-item">
    <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.login' %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.login') }}">
      {{ icons.render('login') }}
      <span class="flex-1 text-left">Login</span>
    </a>
  </li>
  {% endif %}
  {% endif %}
</ul>
