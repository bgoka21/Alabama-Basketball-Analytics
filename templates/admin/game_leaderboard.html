{% extends 'admin/base.html' %}
{% from 'macros/dual_tables.html' import render_dual_section %}

{% block page_controls %}
<form method="get" class="mb-4 flex flex-wrap items-end gap-4">
  <div>
    <label class="font-semibold mr-2">Season:</label>
    <select name="season" class="border p-2 rounded">
      {% for s in all_seasons %}
        <option value="{{ s.id }}" {% if s.id == selected_season %}selected{% endif %}>
          {{ s.season_name }}
        </option>
      {% endfor %}
    </select>
  </div>
  {% for key, values in request.args.lists() %}
    {% if key not in ['season', 'start_date', 'end_date'] %}
      {% for v in values %}
        <input type="hidden" name="{{ key }}" value="{{ v }}">
      {% endfor %}
    {% endif %}
  {% endfor %}
  <div class="flex items-center gap-2">
    <label class="text-sm font-medium">Date:</label>
    <input type="date" name="start_date" value="{{ start_date or '' }}" class="border px-2 py-1 text-sm">
    <span class="text-sm">â€“</span>
    <input type="date" name="end_date" value="{{ end_date or '' }}" class="border px-2 py-1 text-sm">
  </div>
  <div>
    <button type="submit" class="bg-[#9E1B32] hover:bg-[#7f1524] text-white px-5 py-2 rounded">Apply</button>
  </div>
  <div>
    <a href="{{ url_for('admin.leaderboard_game') }}" class="text-gray-600 hover:underline text-sm">Clear</a>
  </div>
</form>
{% endblock %}

{% block content %}
<section class="mb-6">
  <h1 class="text-3xl font-bold mb-2">Game Leaderboard</h1>
  <p class="text-sm text-gray-600">Season Totals vs Last Game snapshots for each focus area.</p>
</section>

<div class="space-y-6">
  {% for group in leaderboard_groups %}
    <details class="bg-white rounded shadow group" open>
      <summary class="flex items-center justify-between px-6 py-4 cursor-pointer select-none">
        <span class="text-lg font-semibold text-gray-900">{{ group.title }}</span>
        <span class="text-sm text-gray-500 transition-transform group-open:-rotate-180">&#9662;</span>
      </summary>
      <div class="border-t border-gray-200 px-6 py-6 space-y-6">
        {% for item in group.items %}
          {% set note = item.note_date.strftime('%b %d, %Y') if item.note_date else None %}
          <div id="{{ item.slug }}" class="space-y-4">
            {{ render_dual_section(item.label, item.table, note, 'No stats for the most recent game.') }}
          </div>
        {% endfor %}
      </div>
    </details>
  {% endfor %}
</div>
{% endblock %}
