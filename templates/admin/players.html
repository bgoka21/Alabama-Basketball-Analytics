{% extends 'admin/base.html' %}
{% from 'macros/table.html' import render_table %}

{% block page_controls %}
<form method="get" class="mb-4 flex items-center gap-2">
  <label class="font-semibold mr-2">Season:</label>
  <select name="season_id" onchange="this.form.submit()" class="border p-2 rounded">
    {% for s in all_seasons %}
      <option value="{{ s.id }}" {% if s.id == selected_season %}selected{% endif %}>
        {{ s.season_name }}
      </option>
    {% endfor %}
  </select>
</form>
{% endblock %}
{% block content %}
  <h1 class="text-2xl font-bold mb-4">Players List</h1>

  {% set columns = [
    {'key': 'player', 'label': 'Player', 'sortable': True, 'align': 'left'},
    {'key': 'actions', 'label': 'Actions', 'sortable': False, 'align': 'center', 'width': 'w-28'}
  ] %}

  {% set table_rows = namespace(items=[]) %}
  {% for player in players %}
    {% set actions %}
      <a
        href="{{ url_for('admin.player_detail', player_name=player, season_id=selected_season) }}"
        class="text-blue-600 hover:underline"
      >
        View Player
      </a>
    {% endset %}
    {% set table_rows.items = table_rows.items + [{
      'player': player,
      'actions': actions | safe
    }] %}
  {% endfor %}

  {{ render_table(
    id='admin-players',
    columns=columns,
    rows=table_rows.items,
    totals=None,
    dense=True,
    sticky_header=True,
    caption='Players List'
  ) }}

  {% if players|length == 0 %}
    <div class="table-empty text-center text-sm text-gray-600 dark:text-gray-300 mt-3">
      No players found for this season.
    </div>
  {% endif %}

  {% if selected_season %}
    <div class="mt-4 text-right">
      <a
        href="{{ url_for('admin.roster', season_id=selected_season) }}"
        class="bg-[#9E1B32] text-white px-4 py-2 rounded hover:bg-[#7a1526]"
      >
        Edit Roster for this Season
      </a>
    </div>
  {% endif %}
{% endblock %}
