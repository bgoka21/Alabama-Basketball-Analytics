{% extends 'base.html' %}
{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/moneyboard-detail.css') }}">
{% endblock %}
{% block content %}

<div class="w-full p-4 sm:p-6 bg-white dark:bg-gray-800 rounded-xl shadow">
  <div class="flex items-center justify-between mb-4">
    <div class="flex items-center gap-2">
      {% if coach and coach.team_logo_url %}
        <img class="team-logo" src="{{ coach.team_logo_url }}" alt="{{ coach_summary.coach_team }} logo" style="height:40px">
      {% endif %}
      <h1 class="text-2xl sm:text-3xl font-bold">{{ coach_name }}</h1>
    </div>
    <div class="flex items-center gap-2">
      {% if current_user.is_authenticated and current_user.is_admin and coach %}
        <a class="btn btn-sm" href="{{ url_for('coach_logo.upload_logo', coach_id=coach.id) }}">Upload Logo</a>
      {% endif %}
      <a class="text-blue-600 hover:underline" href="{{ url_for('recruits.money_board') }}">← Back to Money Board</a>
    </div>
  </div>

  <div class="grid sm:grid-cols-4 gap-3 mb-6">
    <div class="p-3 rounded-xl bg-gray-50 dark:bg-gray-900 border">
      <div class="text-xs text-gray-500">Coach Team</div>
      <div class="font-medium">{{ coach_summary.coach_team or '—' }}</div>
    </div>
    <div class="p-3 rounded-xl bg-gray-50 dark:bg-gray-900 border">
      <div class="text-xs text-gray-500">Coach Conf</div>
      <div class="font-medium">{{ coach_summary.coach_conf or '—' }}</div>
    </div>
    <div class="p-3 rounded-xl bg-gray-50 dark:bg-gray-900 border">
      <div class="text-xs text-gray-500">Recruits</div>
      <div class="font-semibold">{{ coach_summary.recruits }}</div>
    </div>
    <div class="p-3 rounded-xl bg-gray-50 dark:bg-gray-900 border">
      <div class="text-xs text-gray-500">Avg NET / Recruit</div>
      <div class="font-semibold">
        ${{ "{:,.0f}".format(coach_summary.avg_net) }}
      </div>
    </div>
  </div>

  <div class="grid sm:grid-cols-3 gap-3 mb-6">
    <div class="p-3 rounded-xl bg-gray-50 dark:bg-gray-900 border">
      <div class="text-xs text-gray-500">Projected $</div>
      <div class="text-lg font-semibold">{{ coach_summary.proj_sum|fmt_money }}</div>
    </div>
    <div class="p-3 rounded-xl bg-gray-50 dark:bg-gray-900 border">
      <div class="text-xs text-gray-500">Actual $</div>
      <div class="text-lg font-semibold">{{ coach_summary.act_sum|fmt_money }}</div>
    </div>
    <div class="p-3 rounded-xl bg-gray-50 dark:bg-gray-900 border">
      <div class="text-xs text-gray-500">NET $</div>
      <div class="text-lg font-semibold {{ coach_summary.net_sum|posneg }}">{{ coach_summary.net_sum|fmt_money }}</div>
    </div>
  </div>

  <h2 class="text-xl font-semibold mb-2">By Year</h2>
  <div class="overflow-x-auto mb-6">
    <table class="min-w-full text-sm">
      <thead>
        <tr class="text-left border-b">
          <th class="py-2 pr-4">Year</th>
          <th class="py-2 pr-4 text-right">Recruits</th>
          <th class="py-2 pr-4 text-right">Projected $</th>
          <th class="py-2 pr-4 text-right">Actual $</th>
          <th class="py-2 pr-4 text-right">NET $</th>
        </tr>
      </thead>
      <tbody>
        {% for r in by_year %}
        <tr class="border-b">
          <td class="py-2 pr-4">{{ r.year or '—' }}</td>
          <td class="py-2 pr-4 text-right">{{ r.n }}</td>
          <td class="py-2 pr-4 text-right">{{ r.proj_sum|fmt_money }}</td>
          <td class="py-2 pr-4 text-right">{{ r.act_sum|fmt_money }}</td>
          <td class="py-2 pr-4 text-right font-semibold {{ r.net_sum|posneg }}">{{ r.net_sum|fmt_money }}</td>
        </tr>
        {% endfor %}
        {% if not by_year %}
          <tr><td class="py-3 text-gray-500" colspan="5">No year data.</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  <h2 class="text-xl font-semibold mb-2">Players</h2>
  <div class="moneycard">
    <table class="moneytable">
      <thead>
        <tr>
          <th>Player</th>
          <th>Year</th>
          <th>Projected Pick</th>
          <th>Actual Pick</th>
          <th>Projected $</th>
          <th>Actual $</th>
          <th>NET</th>
        </tr>
      </thead>
      <tbody>
        {% for p in players %}
        <tr>
          <td>{{ p.player }}</td>
          <td>{{ p.year or '—' }}</td>
          <td>{{ (p.projected_pick, p.projected_pick_text) | display_pick }}</td>
          <td>{{ (p.actual_pick, p.actual_pick_text) | display_pick }}</td>
          <td>${{ "{:,}".format(p.projected_money|int) }}</td>
          <td>${{ "{:,}".format(p.actual_money|int) }}</td>
          <td class="{{ 'net-pos' if (p.net|int) >= 0 else 'net-neg' }}">
            ${{ "{:,}".format(p.net|int) }}
          </td>
        </tr>
        {% endfor %}
        {% if not players %}
          <tr><td colspan="7">No players found.</td></tr>
        {% endif %}
      </tbody>
      <tfoot>
        <tr>
          <td class="total-label" colspan="6">TOTAL NET</td>
          <td class="total-value">${{ "{:,}".format((coach_summary.net_sum or 0)|int) }}</td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>

{% endblock %}

