{% extends "base.html" %}
{% block content %}
  <h1 class="text-2xl font-bold mb-4">
    {{ recruit.name }}{% if recruit.graduation_year %} (Class of {{ recruit.graduation_year }}){% endif %}
  </h1>

  <div class="flex items-center gap-4 mb-6">
    <a href="{{ url_for('recruits.edit_recruit', id=recruit.id) }}" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-500">Edit</a>
    <form action="{{ url_for('recruits.delete_recruit', id=recruit.id) }}" method="post" onsubmit="return confirm('Delete this recruit?');">
      <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-500">Delete</button>
    </form>
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
    {% if recruit.position %}<div><span class="font-semibold">Position:</span> {{ recruit.position }}</div>{% endif %}
    {% if recruit.height %}<div><span class="font-semibold">Height:</span> {{ recruit.height }}</div>{% endif %}
    {% if recruit.weight %}<div><span class="font-semibold">Weight:</span> {{ recruit.weight }}</div>{% endif %}
    {% if recruit.high_school %}<div><span class="font-semibold">High School:</span> {{ recruit.high_school }}</div>{% endif %}
    {% if recruit.hometown %}<div><span class="font-semibold">Hometown:</span> {{ recruit.hometown }}</div>{% endif %}
    {% if recruit.rating %}<div><span class="font-semibold">Rating:</span> {{ recruit.rating }}</div>{% endif %}
    {% if recruit.ranking %}<div><span class="font-semibold">Ranking:</span> {{ recruit.ranking }}</div>{% endif %}
  </div>

  {% include "partials/shot_type_cards.html" with context %}
  {% include "partials/shot_type_tables.html" with context %}


  <h3 class="text-xl font-semibold mb-2">Top Schools</h3>
  <ul class="mb-4 space-y-1">
    {% for s in recruit.top_schools %}
      <li>
        {{ s.rank }}. {{ s.school_name }}
        <form action="{{ url_for('recruits.delete_school', id=recruit.id, school_id=s.id) }}" method="post" class="inline">
          <button type="submit" class="text-red-600 hover:underline ml-2">Ã—</button>
        </form>
      </li>
    {% endfor %}
  </ul>
  <form action="{{ url_for('recruits.add_school', id=recruit.id) }}" method="post" class="flex flex-wrap items-end gap-2">
    <input name="school_name" placeholder="New School" required class="border p-2 rounded">
    <input name="rank" type="number" placeholder="Rank" min="1" class="border p-2 rounded w-24">
    <button type="submit" class="bg-[#9E1B32] text-white px-4 py-2 rounded hover:bg-[#7a1526]">Add School</button>
  </form>

  <script>
  function showTab(tabName) {
    ['seasonTotals','gameStats','shotType','skillDevelopment'].forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      el.classList.toggle('hidden', id !== tabName);
      el.classList.toggle('block',  id === tabName);
    });
    ['btnSeasonTotals','btnGameStats','btnShotType','btnSkillDevelopment'].forEach(btnId => {
      const b = document.getElementById(btnId);
      if (!b) return;
      if (btnId.toLowerCase().endsWith(tabName.toLowerCase())) {
        b.classList.add('bg-[#9E1B32]', 'text-white');
        b.classList.remove('border-gray-300','bg-white','text-gray-700');
      } else {
        b.classList.remove('bg-[#9E1B32]', 'text-white');
        b.classList.add('border-gray-300','bg-white','text-gray-700');
      }
    });
    window.location.hash = tabName;

    if (tabName === 'shotType') {
      showShotTypeDetail('atr');  // default into ATR whenever you open ShotType
    }
  }

  function showShotTypeDetail(detail) {
    ['atr','fg2','fg3'].forEach(id => {
      const el = document.getElementById(id);
      el.classList.toggle('hidden', id !== detail);
      el.classList.toggle('block',  id === detail);
    });
    const map = { atr:'ATR', fg2:'FG2', fg3:'FG3' };
    Object.entries(map).forEach(([type,suf]) => {
      const card = document.getElementById('card' + suf);
      if (type === detail) {
        card.classList.replace('bg-white','bg-gray-100');
        card.classList.replace('dark:bg-gray-800','dark:bg-gray-700');
        card.classList.replace('shadow-md','shadow-inner');
      } else {
        card.classList.replace('bg-gray-100','bg-white');
        card.classList.replace('dark:bg-gray-700','dark:bg-gray-800');
        card.classList.replace('shadow-inner','shadow-md');
      }
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    showShotTypeDetail('atr');
  });
  </script>

{% endblock %}
