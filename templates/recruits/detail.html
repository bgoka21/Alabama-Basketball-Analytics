{% extends "base.html" %}
{% block page_class %}page--recruit container--wide{% endblock %}
{% block content %}
{# HERO HEADER #}
<div class="w-full rounded-xl mb-6 overflow-hidden shadow">
  <div class="bg-[#9E1B32] text-white">
    <div class="max-w-7xl mx-auto px-4 py-6 flex flex-col sm:flex-row items-center gap-4">
      {% if recruit.profile_image_url %}
        <img src="{{ recruit.profile_image_url }}" alt="{{ recruit.name }} headshot"
             class="w-28 h-28 rounded-full ring-4 ring-white/20 object-cover"
             onerror="this.onerror=null;this.src='{{ url_for('static', filename='img/recruits/placeholder_headshot.svg') }}';">
      {% else %}
        <img src="{{ url_for('static', filename='img/recruits/placeholder_headshot.svg') }}" alt="Headshot"
             class="w-28 h-28 rounded-full ring-4 ring-white/20 object-cover">
      {% endif %}
      <div class="text-center sm:text-left">
        <h1 class="text-3xl sm:text-4xl font-extrabold leading-tight">{{ recruit.name }}</h1>
        <div class="mt-1 text-white/90 text-sm sm:text-base">
          {% if recruit.graduation_year %}Class of {{ recruit.graduation_year }} • {% endif %}
          {% if recruit.position %}{{ recruit.position }}{% endif %}
          {% if recruit.height %} • {{ recruit.height }}{% endif %}
          {% if recruit.weight %} • {{ recruit.weight }}{% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

{# INFO CARDS #}
<div class="max-w-7xl mx-auto px-4">
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
    {% if recruit.high_school %}
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4">
        <div class="text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400 font-semibold">High School</div>
        <div class="text-lg font-bold mt-1 text-black dark:text-white">{{ recruit.high_school }}</div>
      </div>
    {% endif %}
    {% if recruit.hometown %}
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4">
        <div class="text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400 font-semibold">Hometown</div>
        <div class="text-lg font-bold mt-1 text-black dark:text-white">{{ recruit.hometown }}</div>
      </div>
    {% endif %}
    {% if recruit.rating %}
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4">
        <div class="text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400 font-semibold">Rating</div>
        <div class="text-lg font-bold mt-1 text-black dark:text-white">{{ recruit.rating }}</div>
      </div>
    {% endif %}
    {% if recruit.ranking %}
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4">
        <div class="text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400 font-semibold">Ranking</div>
        <div class="text-lg font-bold mt-1 text-black dark:text-white">{{ recruit.ranking }}</div>
      </div>
    {% endif %}
    {% if recruit.aau_team is defined and recruit.aau_team %}
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4">
        <div class="text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400 font-semibold">AAU Team</div>
        <div class="text-lg font-bold mt-1 text-black dark:text-white">{{ recruit.aau_team }}</div>
      </div>
    {% endif %}
    {% if recruit.ppg is defined and recruit.ppg is not none %}
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4">
        <div class="text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400 font-semibold">PPG</div>
        <div class="text-lg font-bold mt-1 text-black dark:text-white">{{ '{:.1f}'.format(recruit.ppg) }}</div>
      </div>
    {% endif %}
    {% if overall_pps is defined %}
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4">
        <div class="text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400 font-semibold">Points per Shot<span class="sr-only">Overall PPS</span></div>
        <div class="text-lg font-bold mt-1 text-black dark:text-white">{{ '{:.2f}'.format(overall_pps) }}</div>
      </div>
    {% endif %}
  </div>
</div>

<div class="max-w-7xl mx-auto px-4 mb-6">
  <h3 class="text-xl font-semibold mb-2">AAU Circuits</h3>
  {% if latest_by_circuit %}
  <div class="space-y-6">
    {% for circuit, stat in latest_by_circuit.items() %}
    {% set has_pnr = stat.pnr_poss is not none or stat.pnr_ppp is not none or stat.pnr_to_pct is not none or stat.pnr_score_pct is not none %}
    <div class="grid grid-cols-1 gap-4">
      <div class="info-card bg-white dark:bg-gray-800 rounded-xl shadow">
        <div class="card-body">
          <div class="card-title text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400 font-semibold mb-1">{{ circuit }}{% if stat.season_year %} — {{ stat.season_year }}{% endif %}</div>
          {% if stat.team_name %}<div class="text-xs text-gray-500 dark:text-gray-400 mb-2">{{ stat.team_name }}</div>{% endif %}
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="mini-card text-center bg-gray-50 dark:bg-gray-700">
              <div class="mini-label">PPG</div>
              <div class="mini-value">{{ '%.1f'|format(stat.ppg) if stat.ppg is not none else '—' }}</div>
            </div>
            <div class="mini-card text-center bg-gray-50 dark:bg-gray-700">
              <div class="mini-label">AST</div>
              <div class="mini-value">{{ '%.1f'|format(stat.ast) if stat.ast is not none else '—' }}</div>
            </div>
            <div class="mini-card text-center bg-gray-50 dark:bg-gray-700">
              <div class="mini-label">TOV</div>
              <div class="mini-value">{{ '%.1f'|format(stat.tov) if stat.tov is not none else '—' }}</div>
            </div>
            <div class="mini-card text-center bg-gray-50 dark:bg-gray-700">
              <div class="mini-label">PPP</div>
              <div class="mini-value">{{ '%.2f'|format(stat.ppp) if stat.ppp is not none else '—' }}</div>
            </div>
          </div>
        </div>
      </div>
      {% if has_pnr %}
      <div class="info-card bg-white dark:bg-gray-800 rounded-xl shadow">
        <div class="card-body">
          <div class="card-title text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400 font-semibold mb-1">PnR (incl. Passes)</div>
          <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">{{ circuit }}{% if stat.season_year %} — {{ stat.season_year }}{% endif %}</div>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="mini-card text-center bg-gray-50 dark:bg-gray-700">
              <div class="mini-label">Poss</div>
              <div class="mini-value">{{ stat.pnr_poss if stat.pnr_poss is not none else '—' }}</div>
            </div>
            <div class="mini-card text-center bg-gray-50 dark:bg-gray-700">
              <div class="mini-label">PPP</div>
              <div class="mini-value">{{ '%.2f'|format(stat.pnr_ppp) if stat.pnr_ppp is not none else '—' }}</div>
            </div>
            <div class="mini-card text-center bg-gray-50 dark:bg-gray-700">
              <div class="mini-label">TO%</div>
              <div class="mini-value">{% if stat.pnr_to_pct is not none %}{{ (stat.pnr_to_pct * 100)|round(1) }}%{% else %}—{% endif %}</div>
            </div>
            <div class="mini-card text-center bg-gray-50 dark:bg-gray-700">
              <div class="mini-label">Score%</div>
              <div class="mini-value">{% if stat.pnr_score_pct is not none %}{{ (stat.pnr_score_pct * 100)|round(1) }}%{% else %}—{% endif %}</div>
            </div>
          </div>
        </div>
      </div>
      {% endif %}
    </div>
    {% set others = stats_by_circuit[circuit][1:] %}
    {% if others %}
    <button type="button" class="text-xs text-blue-600 hover:underline mt-2" onclick="document.getElementById('more-{{ circuit }}').classList.toggle('hidden')">View other seasons</button>
    <div id="more-{{ circuit }}" class="hidden mt-2 space-y-4">
      {% for s in others %}
      <div class="info-card bg-white dark:bg-gray-800 rounded-xl shadow">
        <div class="card-body">
          <div class="card-title text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400 font-semibold mb-1">{{ circuit }}{% if s.season_year %} — {{ s.season_year }}{% endif %}</div>
          {% if s.team_name %}<div class="text-xs text-gray-500 dark:text-gray-400 mb-2">{{ s.team_name }}</div>{% endif %}
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="mini-card text-center bg-gray-50 dark:bg-gray-700">
              <div class="mini-label">PPG</div>
              <div class="mini-value">{{ '%.1f'|format(s.ppg) if s.ppg is not none else '—' }}</div>
            </div>
            <div class="mini-card text-center bg-gray-50 dark:bg-gray-700">
              <div class="mini-label">AST</div>
              <div class="mini-value">{{ '%.1f'|format(s.ast) if s.ast is not none else '—' }}</div>
            </div>
            <div class="mini-card text-center bg-gray-50 dark:bg-gray-700">
              <div class="mini-label">TOV</div>
              <div class="mini-value">{{ '%.1f'|format(s.tov) if s.tov is not none else '—' }}</div>
            </div>
            <div class="mini-card text-center bg-gray-50 dark:bg-gray-700">
              <div class="mini-label">PPP</div>
              <div class="mini-value">{{ '%.2f'|format(s.ppp) if s.ppp is not none else '—' }}</div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}
    {% endfor %}
  </div>
  {% else %}
  <p class="text-gray-500 text-sm">No AAU circuit stats available.</p>
  {% endif %}
</div>

<div class="max-w-7xl mx-auto px-4 mb-6">
  {# Use the shot type tables partial which already contains the
     overview cards acting as tabs. #}
  {% include "partials/shot_type_tables.html" with context %}
</div>

{% if recruit.top_schools and recruit.top_schools|length > 0 %}
<div class="max-w-7xl mx-auto px-4">
  <ul class="mb-4 space-y-1">
    {% for s in recruit.top_schools %}
      <li>
        {{ s.rank }}. {{ s.school_name }}
      </li>
    {% endfor %}
  </ul>
</div>
{% endif %}

  <script>
  function showTab(tabName) {
    ['seasonTotals','gameStats','shotType','skillDevelopment'].forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      el.classList.toggle('hidden', id !== tabName);
      el.classList.toggle('block',  id === tabName);
    });
    ['btnSeasonTotals','btnGameStats','btnShotType','btnSkillDevelopment'].forEach(btnId => {
      const b = document.getElementById(btnId);
      if (!b) return;
      if (btnId.toLowerCase().endsWith(tabName.toLowerCase())) {
        b.classList.add('bg-[#9E1B32]', 'text-white');
        b.classList.remove('border-gray-300','bg-white','text-gray-700');
      } else {
        b.classList.remove('bg-[#9E1B32]', 'text-white');
        b.classList.add('border-gray-300','bg-white','text-gray-700');
      }
    });
    window.location.hash = tabName;

    if (tabName === 'shotType') {
      showShotTypeDetail('atr');  // default into ATR whenever you open ShotType
    }
  }

  function showShotTypeDetail(detail) {
    ['atr','fg2','fg3'].forEach(id => {
      const el = document.getElementById(id);
      el.classList.toggle('hidden', id !== detail);
      el.classList.toggle('block',  id === detail);
    });
    const map = { atr:'ATR', fg2:'FG2', fg3:'FG3' };
    Object.entries(map).forEach(([type,suf]) => {
      const card = document.getElementById('card' + suf);
      if (type === detail) {
        card.classList.replace('bg-white','bg-gray-100');
        card.classList.replace('dark:bg-gray-800','dark:bg-gray-700');
        card.classList.replace('shadow-md','shadow-inner');
      } else {
        card.classList.replace('bg-gray-100','bg-white');
        card.classList.replace('dark:bg-gray-700','dark:bg-gray-800');
        card.classList.replace('shadow-inner','shadow-md');
      }
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    // Display the shot type section by default so clicking the
    // overview cards reveals their respective detail tables just
    // like on the player detail page.
    showTab('shotType');
  });
  </script>

{% endblock %}
