{% extends 'base.html' %}
{% block content %}
<div class="w-full p-4 sm:p-6 bg-white dark:bg-gray-800 rounded-xl shadow">
  <div class="flex items-center justify-between mb-4">
    <h1 class="text-2xl sm:text-3xl font-bold">Compare Coaches</h1>
    <a class="text-blue-600 hover:underline" href="{{ url_for('recruits.money_board') }}">‚Üê Back to Money Board</a>
  </div>

  <form method="get" class="mb-4 flex flex-col gap-3">
    <!-- --- START PATCH: Sticky header & counter --- -->
    <div class="sticky top-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur px-3 py-2 mb-3 border-b border-gray-200 dark:border-gray-800">
      <div class="flex items-center justify-between gap-3">
        <div class="flex items-center gap-2 flex-wrap" id="coach-selected">
          <!-- badges injected by JS -->
        </div>
        <div class="flex items-center gap-3">
          <span id="coach-count" class="text-sm text-gray-500">0/10 selected</span>
          <a href="{{ url_for('recruits.money_board') }}" class="text-sm underline">Clear all</a>
        </div>
      </div>
      <!-- hidden inputs live here for form submits -->
      <div id="coach-hidden" class="hidden"></div>
    </div>
    <!-- --- END PATCH --- -->

    <div class="flex-1">
      <label class="block text-sm mb-1">Select up to ten coaches</label>
      <input id="coach-filter" type="text" placeholder="Search coaches..." class="w-full border rounded p-2 mb-2" />
      <select id="coach-search" class="w-full border rounded p-2" multiple
              data-selected="{{ selected|tojson }}">
      {% for c in coaches %}
        <option value="{{ c }}">{{ c }}</option>
      {% endfor %}
      </select>
    </div>
    <div class="flex justify-end">
      <button id="compare-btn" class="px-4 py-2 rounded bg-gray-900 text-white dark:bg-gray-200 dark:text-black" disabled>Compare</button>
    </div>
  </form>

  {% if comps %}
  <!-- --- START PATCH: Responsive cards grid --- -->
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
    {% for c in comps %}
    <div class="p-4 rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900">
      <div class="text-xs uppercase tracking-wide text-gray-500 mb-1">Coach</div>
      <div class="font-semibold mb-2 truncate">{{ c.coach }}</div>

      <div class="grid grid-cols-2 gap-y-1 text-sm">
        <div class="text-gray-500">Recruits</div>   <div class="text-right font-medium">{{ c.recruits }}</div>
        <div class="text-gray-500">Projected</div>  <div class="text-right">{{ c.proj_sum|fmt_money }}</div>
        <div class="text-gray-500">Actual</div>     <div class="text-right">{{ c.act_sum|fmt_money }}</div>
        <div class="text-gray-500">NET</div>        <div class="text-right font-semibold {{ c.net_sum|posneg }}">{{ c.net_sum|fmt_money }}</div>
        <div class="text-gray-500">Avg NET</div>    <div class="text-right">{{ c.avg_net|fmt_money }}</div>
      </div>
    </div>
    {% endfor %}
  </div>
  <!-- --- END PATCH --- -->
  {% else %}
    <div class="text-sm text-gray-500">Select coaches and click Compare.</div>
  {% endif %}
</div>
<script src="{{ url_for('static', filename='js/coach_autocomplete.js') }}"></script>
{% endblock %}
