{% extends 'base.html' %}
{% block content %}
<h1>Add Recruit</h1>
{% if error %}
<div class="text-red-600">{{ error }}</div>
{% endif %}
<form method="post" action="{{ url_for('recruiting.add_recruit') }}" class="mt-4 space-y-2">
  <input name="name" placeholder="Name" class="border px-2 py-1 w-full" required>
  <input name="position" placeholder="Position" class="border px-2 py-1 w-full">
  <input name="school" placeholder="School" class="border px-2 py-1 w-full">
  <div class="form-group">
    <label for="s247_url">247Sports URL</label>
    <input type="url" class="form-control" name="s247_url" id="s247_url"
           placeholder="https://247sports.com/..." value="{{ request.form.s247_url or '' }}">
  </div>
  <div class="form-group">
    <label for="espn_url">ESPN URL</label>
    <input type="url" class="form-control" name="espn_url" id="espn_url"
           placeholder="https://espn.com/..." value="{{ request.form.espn_url or '' }}">
  </div>
  <div class="form-group">
    <label for="synergy_query">Search Synergy</label>
    <input type="text" class="form-control" name="synergy_query" id="synergy_query"
           placeholder="Player name or IDâ€¦">
    <button type="button" id="synergy-search-btn">Search</button>
  </div>
  <button type="submit" class="btn-primary mt-2">Add Recruit</button>
  <script>
  document.getElementById('synergy-search-btn').addEventListener('click', async () => {
    const query = document.getElementById('synergy_query').value.trim();
    if (!query) return alert('Enter a name or ID to search Synergy.');
    const formData = new FormData();
    formData.append('query', query);
    const res = await fetch("{{ url_for('recruiting.search_synergy') }}", {
      method: 'POST',
      body: formData
    });
    const results = await res.json();
    if (!results.length) return alert('No players found on Synergy.');
    const p = results[0];
    document.querySelector('input[name="name"]').value = p.name;
    if (p.position) document.querySelector('input[name="position"]').value = p.position;
    if (p.school)   document.querySelector('input[name="school"]').value = p.school;
    let hid = document.querySelector('input[name="synergy_player_id"]');
    if (!hid) {
      hid = document.createElement('input');
      hid.type = 'hidden';
      hid.name = 'synergy_player_id';
      document.querySelector('form').appendChild(hid);
    }
    hid.value = p.id;
  });
  </script>
</form>
{% endblock %}
