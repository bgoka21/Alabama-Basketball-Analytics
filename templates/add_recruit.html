{% extends 'base.html' %}
{% block content %}
<h1>Add Recruit</h1>
{% if error %}
<div class="text-red-600">{{ error }}</div>
{% endif %}
<form method="post" action="{{ url_for('recruiting.add_recruit') }}" class="mt-4 space-y-2">
  <input name="name" placeholder="Name" class="border px-2 py-1 w-full" required>
  <input name="position" placeholder="Position" class="border px-2 py-1 w-full">
  <input name="school" placeholder="School" class="border px-2 py-1 w-full">
  <div class="form-group">
    <label for="s247_url">247Sports URL</label>
    <input type="url" class="form-control" name="s247_url" id="s247_url"
           placeholder="https://247sports.com/..." value="{{ request.form.s247_url or '' }}">
  </div>
  <div class="form-group">
    <label for="espn_url">ESPN URL</label>
    <input type="url" class="form-control" name="espn_url" id="espn_url"
           placeholder="https://espn.com/..." value="{{ request.form.espn_url or '' }}">
  </div>
  <div class="form-group relative">
    <label for="synergy_query">Search Synergy</label>
    <input type="text" class="form-control" name="synergy_query" id="synergy_query" autocomplete="off" placeholder="Player nameâ€¦">
    <ul id="synergy-dropdown" class="absolute z-10 bg-white border w-full hidden"></ul>
    <input type="hidden" name="synergy_player_id" id="synergy_player_id">
  </div>
  <button type="submit" class="btn-primary mt-2">Add Recruit</button>
  <script>
  const queryInput = document.getElementById('synergy_query');
  const dropdown = document.getElementById('synergy-dropdown');

  queryInput.addEventListener('input', async () => {
    const query = queryInput.value.trim();
    if (!query) { dropdown.classList.add('hidden'); dropdown.innerHTML=''; return; }
    const formData = new FormData();
    formData.append('query', query);
    const res = await fetch("{{ url_for('recruiting.search_synergy') }}", { method:'POST', body: formData });
    const results = await res.json();
    dropdown.innerHTML = '';
    results.forEach(p => {
      const li = document.createElement('li');
      li.textContent = p.name;
      li.className = 'px-2 py-1 cursor-pointer hover:bg-gray-200';
      li.addEventListener('click', () => {
        document.querySelector('input[name="name"]').value = p.name;
        if (p.position) document.querySelector('input[name="position"]').value = p.position;
        if (p.school)   document.querySelector('input[name="school"]').value   = p.school;
        document.getElementById('synergy_player_id').value = p.id;
        dropdown.classList.add('hidden');
      });
      dropdown.appendChild(li);
    });
    dropdown.classList.toggle('hidden', results.length === 0);
  });
  </script>
</form>
{% endblock %}
