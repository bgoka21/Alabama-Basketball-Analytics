{% if current_user.is_admin %}
{% set mgmt_active = request.endpoint in ['admin.dashboard', 'admin.files_view_unique',
                      'admin.roster', 'admin.users_list',
                      'admin.usage_report', 'admin.correlation_workbench',
                      'admin.custom_stats_index', 'admin.draft_upload',
                      'admin.eybl_import', 'admin.eybl_identity', 'admin.eybl_synonyms',
                      'admin.record_definitions_list', 'admin.record_definitions_new',
                      'admin.record_definitions_edit', 'admin.record_definitions_update',
                      'admin.record_entries_list', 'admin.record_entries_new',
                      'admin.record_entries_edit', 'admin.record_entries_update',
                      'admin.records_recompute', 'admin.records_recompute_seasons',
                      'records_page'] %}
<li class="nav-item">
  <details class="group" {% if mgmt_active %}open{% endif %}>
    <summary class="{{ summary_base_classes }} {{ summary_active_classes }}">
      {{ icons.render('management') }}
      <span class="flex-1 text-left">Management</span>
      <svg class="ml-auto h-4 w-4 shrink-0 transition-transform duration-200 group-open:-rotate-180" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.585l3.71-3.354a.75.75 0 111.02 1.1l-4.25 3.846a.75.75 0 01-1.02 0L5.21 8.33a.75.75 0 01.02-1.12z" clip-rule="evenodd" />
      </svg>
    </summary>
    <div class="ml-4 mt-0 group-open:mt-2 bg-white/10 border border-white/20 rounded-lg px-3 py-2 transition-all flex flex-col space-y-1 opacity-0 -translate-y-1 group-open:opacity-100 group-open:translate-y-0">
      <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.dashboard' %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.dashboard') }}">
        {{ icons.render('dashboard') }}
        <span class="flex-1 text-left">Dashboard</span>
      </a>
      <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.files_view_unique' %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.files_view_unique') }}">
        {{ icons.render('files') }}
        <span class="flex-1 text-left">Files</span>
      </a>
      {% if view_exists('csv_pipeline.csv_pipeline_index') %}
      <a class="{{ link_base_classes }}{% if request.endpoint == 'csv_pipeline.csv_pipeline_index' %} {{ active_classes }}{% endif %}" href="{{ url_for('csv_pipeline.csv_pipeline_index') }}">
        {{ icons.render('table') }}
        <span class="flex-1 text-left">CSV Pipeline</span>
      </a>
      {% endif %}
      <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.roster' %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.roster') }}">
        {{ icons.render('roster') }}
        <span class="flex-1 text-left">Roster</span>
      </a>
      <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.sessions' %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.sessions') }}">
        {{ icons.render('sessions') }}
        <span class="flex-1 text-left">Sessions</span>
      </a>
      <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.users_list' %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.users_list') }}">
        {{ icons.render('users') }}
        <span class="flex-1 text-left">Users</span>
      </a>
      <a class="{{ link_base_classes }}{% if request.endpoint and request.endpoint.startswith('admin.record_definitions') %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.record_definitions_list') }}">
        {{ icons.render('clipboard') }}
        <span class="flex-1 text-left">Record Definitions</span>
      </a>
      <a class="{{ link_base_classes }}{% if request.endpoint and request.endpoint.startswith('admin.record_entries') %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.record_entries_list') }}">
        {{ icons.render('clipboard') }}
        <span class="flex-1 text-left">Record Entries</span>
      </a>
      <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.records_recompute' %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.records_recompute') }}">
        {{ icons.render('clipboard') }}
        <span class="flex-1 text-left">Recompute Records</span>
      </a>
      <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.records_recompute_seasons' %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.records_recompute_seasons') }}">
        {{ icons.render('clipboard') }}
        <span class="flex-1 text-left">Recompute Season Records</span>
      </a>
      {% set records_url = url_for('records_page') if view_exists('records_page') else '#' %}
      <a class="{{ link_base_classes }}{% if request.endpoint == 'records_page' %} {{ active_classes }}{% endif %}" href="{{ records_url }}">
        {{ icons.render('clipboard') }}
        <span class="flex-1 text-left">Records</span>
      </a>
      {% set usage_url = url_for('admin.usage_report') if view_exists('admin.usage_report') else '#' %}
      <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.usage_report' %} {{ active_classes }}{% endif %}" href="{{ usage_url }}">
        {{ icons.render('usage') }}
        <span class="flex-1 text-left">Usage</span>
      </a>
      <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.correlation_workbench' %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.correlation_workbench') }}">
        {{ icons.render('correlation') }}
        <span class="flex-1 text-left">Correlation Workbench</span>
      </a>
      <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.custom_stats_index' %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.custom_stats_index') }}">
        {{ icons.render('table') }}
        <span class="flex-1 text-left">Custom Table</span>
      </a>
      {% if view_exists('admin.draft_upload') %}
      <a class="{{ link_base_classes }}" href="{{ url_for('admin.draft_upload') }}">
        {{ icons.render('upload') }}
        <span class="flex-1 text-left">Draft Upload</span>
      </a>
      {% endif %}
      <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.eybl_import' %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.eybl_import') }}">
        {{ icons.render('import') }}
        <span class="flex-1 text-left">EYBL / AAU Import</span>
      </a>
      <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.eybl_identity' %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.eybl_identity', circuit='EYBL') }}">
        {{ icons.render('identity') }}
        <span class="flex-1 text-left">Identity Review</span>
      </a>
      <a class="{{ link_base_classes }}{% if request.endpoint == 'admin.eybl_synonyms' %} {{ active_classes }}{% endif %}" href="{{ url_for('admin.eybl_synonyms') }}">
        {{ icons.render('synonyms') }}
        <span class="flex-1 text-left">Synonyms</span>
      </a>
    </div>
  </details>
</li>
{% endif %}
