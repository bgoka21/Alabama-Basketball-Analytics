{% extends 'admin/base.html' %}
{% from 'leaderboard/_dual_macros.html' import render_dual_section %}

{% block page_controls %}
  <form method="get" class="mb-4 flex flex-wrap items-end gap-4">
    <div>
      <label class="font-semibold mr-2">Season:</label>
      <select name="season_id" class="border p-2 rounded">
        {% for s in all_seasons %}
          <option value="{{ s.id }}" {% if s.id == selected_season %}selected{% endif %}>
            {{ s.season_name }}
          </option>
        {% endfor %}
      </select>
    </div>
    {% for lbl in selected_labels %}
      <input type="hidden" name="label" value="{{ lbl }}">
    {% endfor %}
    <button type="submit" class="bg-[#9E1B32] hover:bg-[#7f1524] text-white px-5 py-2 rounded">Apply</button>
  </form>
{% endblock %}

{% block content %}
  {% set season_by = season_rows_by_subtype or {} %}
  {% set last_by = last_rows_by_subtype or {} %}
  <div class="space-y-6">
    <div class="bg-white p-6 rounded shadow space-y-6">
      <div>
        <h1 class="text-2xl font-semibold text-gray-900">{{ page_title }}</h1>
        {% if last_practice_date %}
          <p class="text-sm text-gray-600">Last practice: {{ last_practice_date.strftime('%b %d, %Y') }}</p>
        {% endif %}
      </div>

      {{ render_dual_section(
        "Crash",
        season_by.get('crash'),
        season_team_totals.get('crash') if season_team_totals else None,
        last_by.get('crash'),
        last_team_totals.get('crash') if last_team_totals else None,
        plus_label='Crash +',
        opps_label='Crash Opps',
        pct_label='Crash %'
      ) }}

      {{ render_dual_section(
        "Back Man",
        season_by.get('back_man'),
        season_team_totals.get('back_man') if season_team_totals else None,
        last_by.get('back_man'),
        last_team_totals.get('back_man') if last_team_totals else None,
        plus_label='Back Man +',
        opps_label='Back Man Opps',
        pct_label='Back Man %'
      ) }}
    </div>
  </div>
{% endblock %}
