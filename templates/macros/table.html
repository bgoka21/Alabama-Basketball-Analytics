{%- macro render_table(
  id,
  columns,
  rows,
  totals=None,
  dense=True,
  sticky_header=False,
  caption=None,
  default_sort=None
) -%}
  {%- set container_classes = 'rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm overflow-hidden' -%}
  {%- set padding_class = 'px-4 py-2' if dense else 'px-4 py-3' -%}
  <div class="{{ container_classes }}">
    <div class="overflow-x-auto">
      {%- set table_classes = 'min-w-full text-sm table-auto unified-table' -%}
      {%- if sticky_header -%}
        {%- set table_classes = table_classes ~ ' thead-sticky' -%}
      {%- endif -%}
      <table id="{{ id }}" role="table" class="{{ table_classes }}"{% if default_sort %} data-default-sort="{{ default_sort }}"{% endif %}>
        {%- if caption %}
        <caption class="sr-only">{{ caption }}</caption>
        {%- endif %}
        {%- set thead_classes = 'bg-gray-50 dark:bg-gray-800/60 border-b border-gray-200 dark:border-gray-700' -%}
        <thead class="{{ thead_classes }}{% if sticky_header %} sticky top-0 z-10{% endif %}">
          <tr>
            {%- for col in columns %}
              {%- set align = col.align | default('left') -%}
              {%- set align_class = {
                'left': 'text-left',
                'right': 'text-right',
                'center': 'text-center'
              }[align] -%}
              {%- set justify_class = {
                'left': 'justify-start',
                'right': 'justify-end',
                'center': 'justify-center'
              }[align] -%}
              {%- set width_class = col.width if col.width is defined and col.width else '' -%}
              {%- set sticky_class = ' sticky top-0 z-10 bg-gray-50 dark:bg-gray-800/60' if sticky_header else '' -%}
              {%- set th_base_classes = padding_class ~ ' font-semibold text-gray-700 dark:text-gray-200 whitespace-nowrap select-none ' ~ align_class ~ sticky_class -%}
              {%- if col.sortable -%}
                {%- set th_base_classes = th_base_classes ~ ' sortable' -%}
              {%- endif -%}
              <th scope="col"
                  class="{{ th_base_classes }} {{ width_class }}"
                  data-sortable="{{ 'true' if col.sortable else 'false' }}"
                  data-key="{{ col.key }}"
                  aria-sort="none">
                {%- if col.sortable -%}
                  <button type="button" class="inline-flex items-center gap-1 w-full {{ justify_class }} group"
                          aria-label="Sort by {{ col.label }}">
                    <span>{{ col.label | safe }}</span>
                    <span class="sort-caret opacity-0 group-hover:opacity-100 transition" aria-hidden="true"></span>
                  </button>
                {%- else -%}
                  <div class="inline-flex items-center gap-1 w-full {{ justify_class }}">
                    <span>{{ col.label | safe }}</span>
                    <span class="sort-caret opacity-0 transition" aria-hidden="true"></span>
                  </div>
                {%- endif -%}
              </th>
            {%- endfor %}
          </tr>
        </thead>
        <tbody>
          {%- for row in rows %}
          <tr class="odd:bg-white even:bg-gray-50 dark:odd:bg-gray-900 dark:even:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700/60 transition-colors">
            {%- for col in columns %}
              {%- set align = col.align | default('left') -%}
              {%- set align_class = {
                'left': 'text-left',
                'right': 'text-right',
                'center': 'text-center'
              }[align] -%}
              {%- set numeric_class = ' text-right tabular-nums' if align == 'right' else '' -%}
              {%- set cell_value = row.get(col.key) if row is mapping else row | attr(col.key) -%}
              {%- set data_value = '' -%}
              {%- if cell_value is mapping and cell_value.display is defined -%}
                {%- set display_value = cell_value.display -%}
                {%- if cell_value.data_value is defined and cell_value.data_value is not none -%}
                  {%- set data_value = cell_value.data_value -%}
                {%- endif -%}
              {%- else -%}
                {%- set display_value = cell_value if cell_value is not none and cell_value is not undefined else '' -%}
              {%- endif -%}
              {%- if col.value_key is defined and col.value_key -%}
                {%- if row is mapping -%}
                  {%- set override_value = row.get(col.value_key) -%}
                {%- else -%}
                  {%- set override_value = row | attr(col.value_key) -%}
                {%- endif -%}
                {%- if override_value is not none and override_value is not undefined and override_value != '' -%}
                  {%- set data_value = override_value -%}
                {%- endif -%}
              {%- endif -%}
              {%- if data_value is undefined or data_value is none -%}
                {%- set data_value = '' -%}
              {%- endif -%}
              <td class="{{ padding_class }} {{ align_class }}{{ numeric_class }}" data-key="{{ col.key }}"{% if data_value != '' %} data-value="{{ data_value }}"{% endif %}>{{ display_value | trim }}</td>
            {%- endfor %}
          </tr>
          {%- endfor %}
        </tbody>
        {%- if totals %}
        <tfoot>
          <tr class="bg-gray-50 dark:bg-gray-800/60 font-semibold border-t border-gray-200 dark:border-gray-700">
            {%- for col in columns %}
              {%- set align = col.align | default('left') -%}
              {%- set align_class = {
                'left': 'text-left',
                'right': 'text-right',
                'center': 'text-center'
              }[align] -%}
              {%- set numeric_class = ' text-right tabular-nums' if align == 'right' else '' -%}
              {%- set total_value = totals.get(col.key) -%}
              {%- if loop.first -%}
                <th scope="row" class="{{ padding_class }} {{ align_class }}{{ numeric_class }}">
                  {{ total_value if total_value is not none and total_value != '' else 'Totals' }}
                </th>
              {%- else -%}
                <td class="{{ padding_class }} {{ align_class }}{{ numeric_class }}">
                  {{ total_value if total_value is not none else '' }}
                </td>
              {%- endif -%}
            {%- endfor %}
          </tr>
        </tfoot>
        {%- endif %}
      </table>
    </div>
  </div>
{%- endmacro %}

{# Example usage:
{% from 'macros/table.html' import render_table %}

{% set columns = [
  {'key':'rank','label':'#','sortable':true, 'align':'right', 'width':'w-12'},
  {'key':'player','label':'Player','sortable':true, 'align':'left'},
  {'key':'bump_plus','label':'Bump +','sortable':true, 'align':'right'},
  {'key':'bump_opp','label':'Bump Opp','sortable':true, 'align':'right'},
  {'key':'bump_pct','label':'Bump %','sortable':true, 'align':'right'},
] %}

{{ render_table(
  id='defense-bumps',
  columns=columns,
  rows=rows,                 # list of dicts
  totals=totals,             # dict or None
  dense=True,
  sticky_header=False,
  caption='Defense â€” Bumps'
) }}
#}
