{% macro render_dual_section(title, season_rows, season_totals, last_rows, last_totals, columns, note_date=None) %}
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
  <div class="rounded-xl border p-4 bg-white/50 dark:bg-neutral-900/40">
    <div class="flex items-baseline justify-between mb-2">
      <h3 class="text-lg font-semibold">{{ title }} — Practice Totals</h3>
    </div>
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead>
          <tr>
            <th class="text-left pr-2">#</th>
            <th class="text-left pr-2">Player</th>
            {% for col in columns %}
              <th class="text-right pl-2">{{ col }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for r in season_rows or [] %}
          <tr class="border-t">
            <td class="pr-2">{{ r.jersey or r.get('jersey') }}</td>
            <td class="pr-2">{{ r.player or r.get('player') }}</td>
            {% for col in columns %}
              <td class="text-right pl-2">{{ r[col] }}</td>
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  <div class="rounded-xl border p-4 bg-white/50 dark:bg-neutral-900/40">
    <div class="flex items-baseline justify-between mb-2">
      <h3 class="text-lg font-semibold">{{ title }} — Last Practice</h3>
      {% if note_date %}<span class="text-xs opacity-70">({{ note_date }})</span>{% endif %}
    </div>
    {% if last_rows and last_rows|length %}
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead>
          <tr>
            <th class="text-left pr-2">#</th>
            <th class="text-left pr-2">Player</th>
            {% for col in columns %}
              <th class="text-right pl-2">{{ col }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for r in last_rows %}
          <tr class="border-t">
            <td class="pr-2">{{ r.jersey or r.get('jersey') }}</td>
            <td class="pr-2">{{ r.player or r.get('player') }}</td>
            {% for col in columns %}
              <td class="text-right pl-2">{{ r[col] }}</td>
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
      <div class="text-sm opacity-70">No stats for the most recent practice.</div>
    {% endif %}
  </div>
</div>
{% endmacro %}

{# 
  Renders a two-row table header that groups stat columns into
  “Totals” and “Last Practice” with matching stat labels.
  Use with .table-leaderboard + the CSS widths we added.
#}
{% macro render_grouped_last_practice_header(base_stat_labels, left_title='Totals', right_title='Last Practice', extra_headers=None, thead_class='bg-gray-100 border-b-4 border-[#9E1B32]') %}
  {% set stat_count = base_stat_labels|length %}
  {% set extras = extra_headers or [] %}
  {% set ns = namespace(items=[], next_col=2 + stat_count * 2) %}
  {% for header in extras %}
    {% set colspan = header.get('colspan', 1) %}
    {% set data_col = header.get('data_col') %}
    {% if data_col is none %}
      {% set data_col = ns.next_col %}
    {% endif %}
    {% set item = {
      'label': header.get('label'),
      'classes': header.get('classes'),
      'colspan': colspan,
      'rowspan': header.get('rowspan', 1),
      'data_col': data_col,
      'second_row_label': header.get('second_row_label'),
      'second_row_classes': header.get('second_row_classes')
    } %}
    {% set _ = ns.items.append(item) %}
    {% set ns.next_col = data_col + colspan %}
  {% endfor %}
  {% set extra_items = ns.items %}
  <thead{% if thead_class %} class="{{ thead_class }}"{% endif %}>
    <tr>
      <th class="th-num px-4 py-2 text-center sortable" rowspan="2" data-col="0">#</th>
      <th class="th-player px-4 py-2 text-left sortable" rowspan="2" data-col="1">Player</th>
      <th class="th-group px-4 py-2" colspan="{{ stat_count }}">{{ left_title }}</th>
      <th class="th-group px-4 py-2" colspan="{{ stat_count }}">{{ right_title }}</th>
      {% for item in extra_items %}
        {% set classes = item.classes or 'th-stat px-4 py-2 text-center sortable' %}
        <th class="{{ classes }}{% if 'sortable' not in classes %} sortable{% endif %}"
            {% if item.rowspan != 1 %}rowspan="{{ item.rowspan }}"{% endif %}
            {% if item.colspan != 1 %}colspan="{{ item.colspan }}"{% endif %}
            data-col="{{ item.data_col }}">
          {{ item.label }}
        </th>
      {% endfor %}
    </tr>
    <tr>
      {% for label in base_stat_labels %}
        {% set data_col = 2 + loop.index0 %}
        <th class="th-stat px-4 py-2 text-center sortable" data-col="{{ data_col }}">{{ label }}</th>
      {% endfor %}
      {% for label in base_stat_labels %}
        {% set data_col = 2 + stat_count + loop.index0 %}
        <th class="th-stat px-4 py-2 text-center sortable" data-col="{{ data_col }}">{{ label }}</th>
      {% endfor %}
      {% set extra_index = 0 %}
      {% for item in extra_items %}
        {% if item.rowspan == 1 %}
          {% set classes = item.second_row_classes or item.classes or 'th-stat px-4 py-2 text-center sortable' %}
          <th class="{{ classes }}{% if 'sortable' not in classes %} sortable{% endif %}" data-col="{{ item.data_col }}">
            {{ item.second_row_label or item.label }}
          </th>
        {% endif %}
      {% endfor %}
    </tr>
  </thead>
{% endmacro %}

{% macro td_stat(value) -%}
  <td class="px-4 py-2">
    {{ value }}
  </td>
{%- endmacro %}
