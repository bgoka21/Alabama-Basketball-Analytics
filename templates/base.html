<!DOCTYPE html>
<html lang="en" class="bg-white text-black">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alabama Basketball</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
      @media (max-width: 768px) {
        h1 {font-size:1.25rem;line-height:1.75rem;}
        h2 {font-size:1.125rem;line-height:1.5rem;}
        body {font-size:1rem;line-height:1.5rem;}
        #sidebar a,#sidebar summary{display:block;padding:0.75rem 1rem;}
        table{display:block;overflow-x:auto;}
      }

      @media print {
        #sidebar, #mobile-menu-btn, .no-print { display: none !important; }
        main { margin: 0; padding: 0; width: 100%; }
        body { width: 100%; }
        @page { size: letter; margin: 0.5in; }
      }
  </style>
</head>
<body class="min-h-screen flex">

  <!-- Mobile menu button -->
  <button id="mobile-menu-btn" class="md:hidden w-11 h-11 p-2 text-2xl">&#9776;</button>

  <!-- Sidebar -->
  <aside id="sidebar" class="hidden md:flex w-64 bg-[#9E1B32] text-white flex-col px-2 py-4 sm:px-4 sm:py-6">
    <h1 class="text-xl sm:text-2xl font-bold mb-8">Alabama Basketball</h1>

    <nav class="flex flex-col gap-4 flex-1">
      <!-- Home -->
      {% set home_url = url_for('public.homepage') if view_exists('public.homepage') else '#' %}
      <a href="{{ home_url }}"
         class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {{ 'bg-white text-[#9E1B32]' if active_page=='home' else '' }}">
        Home
      </a>

      {% set rec_url = url_for('synergy_stats_page') if view_exists('synergy_stats_page') else '#' %}
      <a href="{{ rec_url }}"
         class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {% if request.path == '/recruits/synergy_stats' %}bg-white text-[#9E1B32]{% endif %}">
        Recruits
      </a>

      {% if current_user.is_authenticated %}

        {# ── Reports dropdown ── #}
        {% set reports_active = active_page in ['game_reports', 'practice_reports'] %}
        <details class="group" {% if reports_active %}open{% endif %}>
          <summary class="px-3 py-2 rounded cursor-pointer transition hover:bg-white hover:text-[#9E1B32]">
            Reports
          </summary>
          <div class="ml-4 mt-2 flex flex-col gap-2">
            <a href="{{ url_for('admin.game_reports') }}"
               class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {{ 'bg-white text-[#9E1B32]' if active_page=='game_reports' else '' }}">
              Game Reports
            </a>
            <a href="{{ url_for('admin.practice_reports') }}"
               class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {{ 'bg-white text-[#9E1B32]' if active_page=='practice_reports' else '' }}">
              Practice Reports
            </a>
          </div>
        </details>

        <!-- Players -->
        <a href="{{ url_for('admin.players_list') }}"
           class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {{ 'bg-white text-[#9E1B32]' if active_page=='players' else '' }}">
          Players
        </a>
        <a href="{{ url_for('admin.skill_totals') }}"
           class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {{ 'bg-white text-[#9E1B32]' if active_page=='skill_totals' else '' }}">
          Skill Totals
        </a>

        {% if current_user.is_admin %}
          {# ── Management dropdown ── #}
          {% set mgmt_active = active_page in ['dashboard', 'files', 'roster', 'users', 'usage'] or request.blueprint == 'merge' %}
          <details class="group" {% if mgmt_active %}open{% endif %}>
            <summary class="px-3 py-2 rounded cursor-pointer transition hover:bg-white hover:text-[#9E1B32]">
              Management
            </summary>
            <div class="ml-4 mt-2 flex flex-col gap-2">
              <a href="{{ url_for('admin.dashboard') }}"
                 class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {{ 'bg-white text-[#9E1B32]' if active_page=='dashboard' else '' }}">
                Dashboard
              </a>
              <a href="{{ url_for('admin.files_view_unique') }}"
                 class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {{ 'bg-white text-[#9E1B32]' if active_page=='files' else '' }}">
                Files
              </a>
              {% if view_exists('merge.merge_csv') %}
              <a href="{{ url_for('merge.merge_csv') }}"
                 class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {{ 'bg-white text-[#9E1B32]' if request.endpoint.startswith('merge.') else '' }}">
                Merge CSV
              </a>
              {% endif %}
              <a href="{{ url_for('admin.roster') }}"
                 class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {{ 'bg-white text-[#9E1B32]' if active_page=='roster' else '' }}">
                Roster
              </a>
              <a href="{{ url_for('admin.users_list') }}"
                 class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {{ 'bg-white text-[#9E1B32]' if active_page=='users' else '' }}">
                Users
              </a>
              {% if current_user.username == 'bgoka21' %}
              <a href="{{ url_for('admin.usage_report') }}"
                 class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32] {{ 'bg-white text-[#9E1B32]' if active_page=='usage' else '' }}">
                Usage
              </a>
              {% endif %}
            </div>
          </details>
        {% endif %}

        <!-- Logout -->
        <a href="{{ url_for('admin.logout') }}"
           class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32]">
          Logout
        </a>
      {% else %}
        <!-- Login (for anonymous users) -->
        <a href="{{ url_for('admin.login') }}"
           class="px-3 py-2 rounded transition hover:bg-white hover:text-[#9E1B32]">
          Login
        </a>
      {% endif %}
    </nav>
    <div class="mt-auto text-xs text-white">
      Stats Updated: {{ last_stats_update }}
    </div>
  </aside>

<!-- Main content -->
<main class="flex-1 p-4 sm:p-6 overflow-y-auto bg-white text-black">
  {# ── Page-specific controls (e.g. season dropdown) ── #}
  {% block page_controls %}{% endblock %}

  {# ── Main page content ── #}
  {% block content %}{% endblock %}
</main>


  <script>
    const btn = document.getElementById('mobile-menu-btn');
    const sidebar = document.getElementById('sidebar');
    btn.addEventListener('click', () => {
      sidebar.classList.toggle('hidden');
    });
  </script>

</body>
</html>
